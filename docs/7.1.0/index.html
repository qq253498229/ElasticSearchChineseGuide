<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>ElasticSearch Java API v7.1.0 (未开始)</title>
<style>
/* normalize.css */

button, hr, input {
    overflow: visible
}

audio, canvas, progress, video {
    display: inline-block
}

progress, sub, sup {
    vertical-align: baseline
}

html {
    font-family: sans-serif;
    line-height: 1.15;
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%
}

body {
    margin: 0
}

menu, article, aside, details, footer, header, nav, section {
    display: block
}

h1 {
    font-size: 2em;
    margin: .67em 0
}

figcaption, figure, main {
    display: block
}

figure {
    margin: 1em 40px
}

hr {
    box-sizing: content-box;
    height: 0
}

code, kbd, pre, samp {
    font-family: monospace, monospace;
    font-size: 1em
}

a {
    background-color: transparent;
    -webkit-text-decoration-skip: objects
}

a:active, a:hover {
    outline-width: 0
}

abbr[title] {
    border-bottom: none;
    text-decoration: underline;
    text-decoration: underline dotted
}

b, strong {
    font-weight: bolder
}

dfn {
    font-style: italic
}

mark {
    background-color: #ff0;
    color: #000
}

small {
    font-size: 80%
}

sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative
}

sub {
    bottom: -.25em
}

sup {
    top: -.5em
}

audio:not([controls]) {
    display: none;
    height: 0
}

img {
    border-style: none
}

svg:not(:root) {
    overflow: hidden
}

button, input, optgroup, select, textarea {
    font-family: sans-serif;
    font-size: 100%;
    line-height: 1.15;
    margin: 0
}

button, input {
}

button, select {
    text-transform: none
}

[type=submit], [type=reset], button, html [type=button] {
    -webkit-appearance: button
}

[type=button]::-moz-focus-inner, [type=reset]::-moz-focus-inner, [type=submit]::-moz-focus-inner, button::-moz-focus-inner {
    border-style: none;
    padding: 0
}

[type=button]:-moz-focusring, [type=reset]:-moz-focusring, [type=submit]:-moz-focusring, button:-moz-focusring {
    outline: ButtonText dotted 1px
}

fieldset {
    border: 1px solid silver;
    margin: 0 2px;
    padding: .35em .625em .75em
}

legend {
    box-sizing: border-box;
    color: inherit;
    display: table;
    max-width: 100%;
    padding: 0;
    white-space: normal
}

progress {
}

textarea {
    overflow: auto
}

[type=checkbox], [type=radio] {
    box-sizing: border-box;
    padding: 0
}

[type=number]::-webkit-inner-spin-button, [type=number]::-webkit-outer-spin-button {
    height: auto
}

[type=search] {
    -webkit-appearance: textfield;
    outline-offset: -2px
}

[type=search]::-webkit-search-cancel-button, [type=search]::-webkit-search-decoration {
    -webkit-appearance: none
}

::-webkit-file-upload-button {
    -webkit-appearance: button;
    font: inherit
}

summary {
    display: list-item
}

[hidden], template {
    display: none
}

/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc {
    overflow-y: auto
}

.toc > ul {
    overflow: hidden;
    position: relative
}

.toc-list {
    margin: 0;
    padding-left: 10px
}

a.toc-link {
    color: currentColor;
    height: 100%
}

.is-collapsible {
    max-height: 1000px;
    overflow: hidden;
    transition: all 300ms ease-in-out
}

.is-collapsed {
    max-height: 0
}

.is-position-fixed {
    position: fixed !important;
    top: 0
}

.is-active-link {
    font-weight: 700
}

.toc-link::before {
    background-color: #f9f9fb;
    content: ' ';
    display: inline-block;
    height: inherit;
    left: 8px;
    margin-top: -1px;
    position: absolute;
    width: 2px
}

.is-active-link::before {
    background-color: #54BC4B
}


/* Activiti Specific */

body {
    color: #494d55;
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

html, body {
    height: 100%;
    width: 100%;
    background: #f9f9f9;
    font-family: "Helvetica Neue", Helvetica, Roboto, Arial, sans-serif;
    color: #484848
}

.page-wrapper {
    min-height: 100%;
    /* equal to footer height */
    margin-bottom: -50px;
}

.page-wrapper:after {
    content: "";
    display: block;
    height: 50px;
}

#header {
    position: fixed;
    top: 0px;
    z-index: 100000;
    width: 100%;
}

#header > h1 {
    background-image: radial-gradient(circle, #1280e1 0%, #002069 100%);
    color: #f9f9f9;
    padding: 20px 0 20px 20px;
    font-size: 3em;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
    background-size: 180px 54px;
    background-repeat: no-repeat;
    width: 337px;
    height: 54px;
    display: inline-block;
    content: '';
    margin-right: 30px;
}

#author {
    margin-left: 25%;
    font-size: 40px;
}

#content {
    margin: 129px 0 0 27%;
    padding: 10px 40px 0 20px;
    padding-right: 40px;
    line-height: 1.7;
    width: 67%;
    overflow-x: auto;
}

h2, h3, h4, h5, h6 {
    color: #00345a;
}

h2 {
    font-size: 26px;
    margin-top: 0;
    margin-bottom: 20px;
    font-weight: bold;
    padding-bottom: 10px;
    border-bottom: 1px solid #d7d7d7;
}

h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 0;
    font-weight: bold;
    padding-bottom: 10px;
    /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
    margin-bottom: 20px;
}

.clear {
    clear: both;
}

.note, .listingblock, .literalblock {
    overflow-x: auto;
    position: relative;
    width: 100%;
    margin: 0 0 15px 0;
    background-color: #F0F0F0;
    border-left: 3px solid #00a9e5;
    display: inline-flex;
    padding-left: 10px;
}

table.tableblock {
    width: 100%;
    max-width: 100%;
    margin-bottom: 20px;
    background-color: transparent;
    border-spacing: 0;
    border-collapse: collapse;
    border: 1px solid #ddd;
    table-layout: fixed;
}

table.tableblock > caption + thead > tr:first-child > td, table.tableblock > caption + thead > tr:first-child > th, table.tableblock > colgroup + thead > tr:first-child > td, table.tableblock > colgroup + thead > tr:first-child > th, table.tableblock > thead:first-child > tr:first-child > td, table.tableblock > thead:first-child > tr:first-child > th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock > thead > tr > th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock > tbody > tr > td, table.tableblock > tbody > tr > th, table.tableblock > tfoot > tr > td, table.tableblock > tfoot > tr > th, table.tableblock > thead > tr > td, table.tableblock > thead > tr > th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
    margin: 0;
}

td.content {
    white-space: normal;
}

pre, td, th {
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;
}

img {
    max-width: 100%;
}

a {
    color: #007387;
}

a:hover {
    color: #004c59;
}

#toc-parent {
    width: 23%;
    float: left;
    height: 100%;
    overflow-y: auto;
    position: fixed;
    padding: 10px;
    border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
    text-decoration: none;
}

.toc-list {
    margin: 0 20px 0 10px;
}

.toc-list-item {
    padding: 4px 0 4px 0;
}


div.sect5 p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5 code {
    font-family: "Helvetica Neue", Helvetica, Roboto, Arial, sans-serif;
}

.warning td.icon {
    background: url('../images/warning.png') no-repeat 0 45%;
    width: 70px;
}

.warning td.icon .title {
    visibility: hidden;
}

.important td.icon {
    background: url('../images/important.png') no-repeat 0 45%;
    width: 70px;
}

.important td.icon .title {
    visibility: hidden;
}

.note td.icon {
    background: url('../images/note.png') no-repeat 0 45%;
    width: 60px;
}

.note td.icon .title {
    visibility: hidden;
}

.conum[data-value] {
    display: inline-block;
    color: #fff !important;
    background-color: rgba(0, 0, 0, 0.8);
    -webkit-border-radius: 100px;
    border-radius: 100px;
    text-align: center;
    width: 1.67em;
    height: 1.67em;
    font-size: 0.75em;
    line-height: 1.67em;
    font-family: "Open Sans", "Sans", sans-serif;
    font-style: normal;
    font-weight: bold;
}

.conum[data-value] + b {
    display: none;
}

.conum[data-value]:after {
    content: attr(data-value);
}

*:not(pre) > code {
    font-size: .9375em;
    font-weight: normal;
    color: rgba(0, 0, 0, 0.9);
    background-color: #eaeaef;
    -webkit-border-radius: 4px;
    border-radius: 4px;
    line-height: 1.45;
    padding: 0.1em 0.5ex;
    word-spacing: -.15em;
}

.admonitionblock {
    background: #f2f2f3;
    padding: 10px;
    min-height: 80px;
    margin: 15px 0;
    border-radius: 5px;
    position: relative;
}

h1 {
    filter: alpha(Opacity=93);
    -moz-opacity: 0.93;
    opacity: 0.93;
}

.choose-version {
    position: fixed;
    right: 5px;
    z-index: 9999;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Pygments CSS disabled. Pygments is not available. */
</style>
<script type="text/javascript">

    /*
     * Tocbot.min.js version 2.1.4
     */

    !function (e) {
        function t(o) {
            if (n[o]) return n[o].exports;
            var i = n[o] = {exports: {}, id: o, loaded: !1};
            return e[o].call(i.exports, i, i.exports, t), i.loaded = !0, i.exports
        }

        var n = {};
        return t.m = e, t.c = n, t.p = "", t(0)
    }([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
        function (e, t, n) {
            var o, i, r;
            (function (l) {
                !function (n, l) {
                    i = [], o = l(n), r = "function" == typeof o ? o.apply(t, i) : o, !(void 0 !== r && (e.exports = r))
                }("undefined" != typeof l ? l : this.window || this.global, function (e) {
                    "use strict";

                    function t() {
                        for (var e = {}, t = 0; t < arguments.length; t++) {
                            var n = arguments[t];
                            for (var o in n) h.call(n, o) && (e[o] = n[o])
                        }
                        return e
                    }

                    function o(e, t, n) {
                        t || (t = 250);
                        var o, i;
                        return function () {
                            var r = n || this, l = +new Date, s = arguments;
                            o && l < o + t ? (clearTimeout(i), i = setTimeout(function () {
                                o = l, e.apply(r, s)
                            }, t)) : (o = l, e.apply(r, s))
                        }
                    }

                    var i, r, l, s = n(/*! smooth-scroll */1), c = n(/*! ./default-options.js */2), a = {}, u = {},
                        d = n(/*! ./build-html.js */3), f = n(/*! ./parse-content.js */4),
                        m = (e.document, document.body, !!e.document.querySelector && !!e.addEventListener),
                        h = Object.prototype.hasOwnProperty;
                    return u.destroy = function () {
                        try {
                            document.querySelector(a.tocSelector).innerHTML = ""
                        } catch (e) {
                            console.warn("Element not found: " + a.tocSelector)
                        }
                        document.removeEventListener("scroll", this._scrollListener, !1), document.removeEventListener("resize", this._scrollListener, !1), i && document.removeEventListener("click", this._clickListener, !1), s && s.destroy()
                    }, u.init = function (e) {
                        if (m && (a = t(c, e || {}), this.options = a, this.state = {}, i = d(a), r = f(a), this._buildHtml = i, this._parseContent = r, u.destroy(), l = r.selectHeadings(a.contentSelector, a.headingSelector), null !== l)) {
                            var n = r.nestHeadingsArray(l), h = n.nest;
                            return i.render(a.tocSelector, h), this._scrollListener = o(function () {
                                i.updateToc(l)
                            }, a.throttleTimeout), this._scrollListener(), document.addEventListener("scroll", this._scrollListener, !1), document.addEventListener("resize", this._scrollListener, !1), this._clickListener = o(function (e) {
                                i.disableTocAnimation(e), i.updateToc(l)
                            }, a.throttleTimeout), document.addEventListener("click", this._clickListener, !1), s && (this.smoothScroll = s.init(t(a.smoothScrollOptions, {callback: i.enableTocAnimation}))), this
                        }
                    }, u.refresh = function (e) {
                        u.destroy(), u.init(e || this.options)
                    }, e.tocbot = u, u
                })
            }).call(t, function () {
                return this
            }())
        },/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
        function (e, t, n) {
            var o, i, r;
            (function (n) {/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
                !function (n, l) {
                    i = [], o = l(n), r = "function" == typeof o ? o.apply(t, i) : o, !(void 0 !== r && (e.exports = r))
                }("undefined" != typeof n ? n : this.window || this.global, function (e) {
                    "use strict";
                    var t, n, o, i, r, l, s, c = {}, a = "querySelector" in document && "addEventListener" in e, u = {
                        selector: "[data-scroll]",
                        selectorHeader: null,
                        speed: 500,
                        easing: "easeInOutCubic",
                        offset: 0,
                        callback: function () {
                        }
                    }, d = function () {
                        var e = {}, t = !1, n = 0, o = arguments.length;
                        "[object Boolean]" === Object.prototype.toString.call(arguments[0]) && (t = arguments[0], n++);
                        for (var i = function (n) {
                            for (var o in n) Object.prototype.hasOwnProperty.call(n, o) && (t && "[object Object]" === Object.prototype.toString.call(n[o]) ? e[o] = d(!0, e[o], n[o]) : e[o] = n[o])
                        }; o > n; n++) {
                            var r = arguments[n];
                            i(r)
                        }
                        return e
                    }, f = function (e) {
                        return Math.max(e.scrollHeight, e.offsetHeight, e.clientHeight)
                    }, m = function (e, t) {
                        var n, o, i = t.charAt(0), r = "classList" in document.documentElement;
                        for ("[" === i && (t = t.substr(1, t.length - 2), n = t.split("="), n.length > 1 && (o = !0, n[1] = n[1].replace(/"/g, "").replace(/'/g, ""))); e && e !== document && 1 === e.nodeType; e = e.parentNode) {
                            if ("." === i) if (r) {
                                if (e.classList.contains(t.substr(1))) return e
                            } else if (new RegExp("(^|\\s)" + t.substr(1) + "(\\s|$)").test(e.className)) return e;
                            if ("#" === i && e.id === t.substr(1)) return e;
                            if ("[" === i && e.hasAttribute(n[0])) {
                                if (!o) return e;
                                if (e.getAttribute(n[0]) === n[1]) return e
                            }
                            if (e.tagName.toLowerCase() === t) return e
                        }
                        return null
                    }, h = function (e) {
                        "#" === e.charAt(0) && (e = e.substr(1));
                        for (var t, n = String(e), o = n.length, i = -1, r = "", l = n.charCodeAt(0); ++i < o;) {
                            if (t = n.charCodeAt(i), 0 === t) throw new InvalidCharacterError("Invalid character: the input contains U+0000.");
                            r += t >= 1 && 31 >= t || 127 == t || 0 === i && t >= 48 && 57 >= t || 1 === i && t >= 48 && 57 >= t && 45 === l ? "\\" + t.toString(16) + " " : t >= 128 || 45 === t || 95 === t || t >= 48 && 57 >= t || t >= 65 && 90 >= t || t >= 97 && 122 >= t ? n.charAt(i) : "\\" + n.charAt(i)
                        }
                        return "#" + r
                    }, p = function (e, t) {
                        var n;
                        return "easeInQuad" === e && (n = t * t), "easeOutQuad" === e && (n = t * (2 - t)), "easeInOutQuad" === e && (n = .5 > t ? 2 * t * t : -1 + (4 - 2 * t) * t), "easeInCubic" === e && (n = t * t * t), "easeOutCubic" === e && (n = --t * t * t + 1), "easeInOutCubic" === e && (n = .5 > t ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1), "easeInQuart" === e && (n = t * t * t * t), "easeOutQuart" === e && (n = 1 - --t * t * t * t), "easeInOutQuart" === e && (n = .5 > t ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t), "easeInQuint" === e && (n = t * t * t * t * t), "easeOutQuint" === e && (n = 1 + --t * t * t * t * t), "easeInOutQuint" === e && (n = .5 > t ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t), n || t
                    }, v = function (e, t, n) {
                        var o = 0;
                        if (e.offsetParent) do o += e.offsetTop, e = e.offsetParent; while (e);
                        return o = Math.max(o - t - n, 0), Math.min(o, b() - g())
                    }, g = function () {
                        return Math.max(document.documentElement.clientHeight, e.innerHeight || 0)
                    }, b = function () {
                        return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight, document.body.clientHeight, document.documentElement.clientHeight)
                    }, C = function (e) {
                        return e && "object" == typeof JSON && "function" == typeof JSON.parse ? JSON.parse(e) : {}
                    }, S = function (e) {
                        return e ? f(e) + e.offsetTop : 0
                    }, y = function (t, n, o) {
                        o || (t.focus(), document.activeElement.id !== t.id && (t.setAttribute("tabindex", "-1"), t.focus(), t.style.outline = "none"), e.scrollTo(0, n))
                    };
                    c.animateScroll = function (n, o, l) {
                        var c = C(o ? o.getAttribute("data-options") : null), a = d(t || u, l || {}, c),
                            f = "[object Number]" === Object.prototype.toString.call(n), m = f || !n.tagName ? null : n;
                        if (f || m) {
                            var h = e.pageYOffset;
                            a.selectorHeader && !i && (i = document.querySelector(a.selectorHeader)), r || (r = S(i));
                            var g, x, N = f ? n : v(m, r, parseInt(a.offset, 10)), L = N - h, O = b(), E = 0,
                                A = function (t, i, r) {
                                    var l = e.pageYOffset;
                                    (t == i || l == i || e.innerHeight + l >= O) && (clearInterval(r), y(n, i, f), a.callback(n, o))
                                }, H = function () {
                                    E += 16, g = E / parseInt(a.speed, 10), g = g > 1 ? 1 : g, x = h + L * p(a.easing, g), e.scrollTo(0, Math.floor(x)), A(x, N, s)
                                }, T = function () {
                                    clearInterval(s), s = setInterval(H, 16)
                                };
                            0 === e.pageYOffset && e.scrollTo(0, 0), T()
                        }
                    };
                    var x = function (t) {
                        e.location.hash, n && (n.id = n.getAttribute("data-scroll-id"), c.animateScroll(n, o), n = null, o = null)
                    }, N = function (i) {
                        if (0 === i.button && !i.metaKey && !i.ctrlKey && (o = m(i.target, t.selector), o && "a" === o.tagName.toLowerCase() && o.hostname === e.location.hostname && o.pathname === e.location.pathname && /#/.test(o.href))) {
                            var r = h(o.hash);
                            if ("#" === r) {
                                i.preventDefault(), n = document.body;
                                var l = n.id ? n.id : "smooth-scroll-top";
                                return n.setAttribute("data-scroll-id", l), n.id = "", void (e.location.hash.substring(1) === l ? x() : e.location.hash = l)
                            }
                            n = document.querySelector(r), n && (n.setAttribute("data-scroll-id", n.id), n.id = "", o.hash === e.location.hash && (i.preventDefault(), x()))
                        }
                    }, L = function (e) {
                        l || (l = setTimeout(function () {
                            l = null, r = S(i)
                        }, 66))
                    };
                    return c.destroy = function () {
                        t && (document.removeEventListener("click", N, !1), e.removeEventListener("resize", L, !1), t = null, n = null, o = null, i = null, r = null, l = null, s = null)
                    }, c.init = function (n) {
                        a && (c.destroy(), t = d(u, n || {}), i = t.selectorHeader ? document.querySelector(t.selectorHeader) : null, r = S(i), document.addEventListener("click", N, !1), e.addEventListener("hashchange", x, !1), i && e.addEventListener("resize", L, !1))
                    }, c
                })
            }).call(t, function () {
                return this
            }())
        },/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
        function (e, t) {
            e.exports = {
                tocSelector: ".js-toc",
                contentSelector: ".js-toc-content",
                headingSelector: "h1, h2, h3",
                ignoreSelector: ".js-toc-ignore",
                linkClass: "toc-link",
                extraLinkClasses: "",
                activeLinkClass: "is-active-link",
                listClass: "toc-list",
                extraListClasses: "",
                isCollapsedClass: "is-collapsed",
                collapsibleClass: "is-collapsible",
                listItemClass: "toc-list-item",
                collapseDepth: 0,
                smoothScrollOptions: {easing: "easeInOutCubic", offset: 0, speed: 300, updateURL: !0},
                headingsOffset: 0,
                throttleTimeout: 50,
                positionFixedSelector: null,
                positionFixedClass: "is-position-fixed",
                fixedSidebarOffset: "auto",
                includeHtml: !1
            }
        },/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
        function (e, t) {
            e.exports = function (e) {
                function t(e, n) {
                    var r = n.appendChild(o(e));
                    if (e.children.length) {
                        var l = i(e.isCollapsed);
                        e.children.forEach(function (e) {
                            t(e, l)
                        }), r.appendChild(l)
                    }
                }

                function n(e, n) {
                    var o = !1, r = i(o);
                    n.forEach(function (e) {
                        t(e, r)
                    });
                    var l = document.querySelector(e);
                    if (null !== l) return l.firstChild && l.removeChild(l.firstChild), l.appendChild(r)
                }

                function o(t) {
                    var n = document.createElement("li"), o = document.createElement("a");
                    return e.listItemClass && n.setAttribute("class", e.listItemClass), e.includeHtml && t.childNodes.length ? u.call(t.childNodes, function (e) {
                        o.appendChild(e.cloneNode(!0))
                    }) : o.textContent = t.textContent, o.setAttribute("data-scroll", ""), o.setAttribute("href", "#" + t.id), o.setAttribute("class", e.linkClass + h + "node-name--" + t.nodeName + h + e.extraLinkClasses), n.appendChild(o), n
                }

                function i(t) {
                    var n = document.createElement("ul"), o = e.listClass + h + e.extraListClasses;
                    return t && (o += h + e.collapsibleClass, o += h + e.isCollapsedClass), n.setAttribute("class", o), n
                }

                function r() {
                    var t = document.documentElement.scrollTop || f.scrollTop,
                        n = document.querySelector(e.positionFixedSelector);
                    "auto" === e.fixedSidebarOffset && (e.fixedSidebarOffset = document.querySelector(e.tocSelector).offsetTop), t > e.fixedSidebarOffset ? n.className.indexOf(e.positionFixedClass) === -1 && (n.className += h + e.positionFixedClass) : n.className = n.className.split(h + e.positionFixedClass).join("")
                }

                function l(t) {
                    var n = document.documentElement.scrollTop || f.scrollTop;
                    e.positionFixedSelector && r();
                    var o, i = t;
                    if (m && null !== document.querySelector(e.tocSelector) && i.length > 0) {
                        d.call(i, function (t, r) {
                            if (t.offsetTop > n + e.headingsOffset) {
                                var l = 0 === r ? r : r - 1;
                                return o = i[l], !0
                            }
                            if (r === i.length - 1) return o = i[i.length - 1], !0
                        });
                        var l = document.querySelector(e.tocSelector).querySelectorAll("." + e.linkClass);
                        u.call(l, function (t) {
                            t.className = t.className.split(h + e.activeLinkClass).join("")
                        });
                        var c = document.querySelector(e.tocSelector).querySelector("." + e.linkClass + ".node-name--" + o.nodeName + '[href="#' + o.id + '"]');
                        c.className += h + e.activeLinkClass;
                        var a = document.querySelector(e.tocSelector).querySelectorAll("." + e.listClass + "." + e.collapsibleClass);
                        u.call(a, function (t) {
                            var n = h + e.isCollapsedClass;
                            t.className.indexOf(n) === -1 && (t.className += h + e.isCollapsedClass)
                        }), c.nextSibling && (c.nextSibling.className = c.nextSibling.className.split(h + e.isCollapsedClass).join("")), s(c.parentNode.parentNode)
                    }
                }

                function s(t) {
                    return t.className.indexOf(e.collapsibleClass) !== -1 ? (t.className = t.className.split(h + e.isCollapsedClass).join(""), s(t.parentNode.parentNode)) : t
                }

                function c(t) {
                    var n = t.target || t.srcElement;
                    n.className.indexOf(e.linkClass) !== -1 && (m = !1)
                }

                function a() {
                    m = !0
                }

                var u = [].forEach, d = [].some, f = document.body, m = !0, h = " ";
                return {enableTocAnimation: a, disableTocAnimation: c, render: n, updateToc: l}
            }
        },/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
        function (e, t) {
            e.exports = function (e) {
                function t(e) {
                    return e[e.length - 1]
                }

                function n(e) {
                    return +e.nodeName.split("H").join("")
                }

                function o(t) {
                    var o = {
                        id: t.id,
                        children: [],
                        nodeName: t.nodeName,
                        headingLevel: n(t),
                        textContent: t.textContent.trim()
                    };
                    return e.includeHtml && (o.childNodes = t.childNodes), o
                }

                function i(i, r) {
                    for (var l = o(i), s = n(i), c = r, a = t(c), u = a ? a.headingLevel : 0, d = s - u; d > 0;) a = t(c), a && void 0 !== a.children && (c = a.children), d--;
                    return s >= e.collapseDepth && (l.isCollapsed = !0), c.push(l), c
                }

                function r(t, n) {
                    var o = n;
                    e.ignoreSelector && (o = n.split(",").map(function (t) {
                        return t.trim() + ":not(" + e.ignoreSelector + ")"
                    }));
                    try {
                        return document.querySelector(t).querySelectorAll(o)
                    } catch (i) {
                        return console.warn("Element not found: " + t), null
                    }
                }

                function l(e) {
                    return s.call(e, function (e, t) {
                        var n = o(t);
                        return i(n, e.nest), e
                    }, {nest: []})
                }

                var s = [].reduce;
                return {nestHeadingsArray: l, selectHeadings: r}
            }
        }]);
    //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

    var generateToc = function () {
        var readyState = document.readyState;
        if (readyState === 'interactive' || readyState == 'complete') {

            var headerSize = 140;

            var tocParentNode = document.createElement("div");
            tocParentNode.setAttribute("id", "toc-parent");

            var generatedTocNode = document.createElement("div");
            generatedTocNode.setAttribute("id", "generated-toc");
            tocParentNode.appendChild(generatedTocNode);

            var contentNode = document.getElementById("content");
            contentNode.parentNode.insertBefore(tocParentNode, contentNode);

            var clearNode = document.createElement("div");
            clearNode.setAttribute("class", "clear");
            contentNode.parentNode.appendChild(clearNode);

            tocbot.init({
                tocSelector: '#generated-toc',
                contentSelector: '#content',
                headingSelector: 'h2, h3, h4, h5',
                headingsOffset: headerSize,
                smoothScrollOptions: {
                    easing: 'easeInOutCubic',
                    offset: headerSize,
                    speed: 300, // animation duration.
                    updateURL: true
                },
                collapseDepth: 0
            });

        } else {
            window.setTimeout(function () {
                generateToc();
            }, 50);
        }

    }
    generateToc();

</script>

<div class="choose-version">
    <select id="choose-version" onchange="chooseVersion(this.value)">
        <option value="6.8.0">6.8.0</option>
        <option value="7.1.0">7.1.0</option>
    </select>
</div>

<script type="text/javascript">
    var initVersion = function () {
        var list = window.location.pathname.split('/');
        document.getElementById('choose-version').value = list[list.length - 2];
    };
    initVersion();

    var chooseVersion = function (obj) {
        window.location.href = '../' + obj;
    }
</script>
</head>
<body id="java-api" class="book">
<div id="header">
<h1>ElasticSearch Java API v7.1.0 (未开始)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface">1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>deprecated[7.0.0, The <code>TransportClient</code> is deprecated in favour of the {java-rest}/java-rest-high.html[Java High Level REST Client] and will be removed in Elasticsearch 8.0. The {java-rest}/java-rest-high-level-migration.html[migration guide] describes all the steps needed to migrate.]</p>
</div>
<div class="paragraph">
<p>This section describes the Java API that Elasticsearch provides. All
Elasticsearch operations are executed using a
<a href="#client">Client</a> object. All
operations are completely asynchronous in nature (either accepts a
listener, or returns a future).</p>
</div>
<div class="paragraph">
<p>Additionally, operations on a client may be accumulated and executed in
<a href="#java-docs-bulk">Bulk</a>.</p>
</div>
<div class="paragraph">
<p>Note, all the APIs are exposed through the
Java API (actually, the Java API is used internally to execute them).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javadoc">2. Javadoc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The javadoc for the transport client can be found at <a href="https://snapshots.elastic.co/javadoc/org/elasticsearch/client/transport/7.1.0-SNAPSHOT/index.html" class="bare">https://snapshots.elastic.co/javadoc/org/elasticsearch/client/transport/7.1.0-SNAPSHOT/index.html</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_repository">3. Maven Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch is hosted on
<a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.elasticsearch.client%22">Maven
Central</a>.</p>
</div>
<div class="paragraph">
<p>For example, you can define the latest version in your <code>pom.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><dependency>
    <groupId>org.elasticsearch.client</groupId>
    <artifactId>transport</artifactId>
    <version>7.1.0</version>
</dependency></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="java-transport-usage-maven-lucene">3.1. Lucene Snapshot repository</h3>
<div class="paragraph">
<p>The very first releases of any major version (like a beta), might have been built on top of a Lucene Snapshot version.
In such a case you will be unable to resolve the Lucene dependencies of the client.</p>
</div>
<div class="paragraph">
<p>For example, if you want to use the <code>6.0.0-beta1</code> version which depends on Lucene <code>7.0.0-snapshot-00142c9</code>, you must
define the following repository.</p>
</div>
<div class="paragraph">
<p>For Maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><repository>
    <id>elastic-lucene-snapshots</id>
    <name>Elastic Lucene Snapshots</name>
    <url>https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/00142c9</url>
    <releases><enabled>true</enabled></releases>
    <snapshots><enabled>false</enabled></snapshots>
</repository></code></pre>
</div>
</div>
<div class="paragraph">
<p>For Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy">maven {
    name "lucene-snapshots"
    url 'https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/00142c9'
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log4j_2_logger">3.2. Log4j 2 Logger</h3>
<div class="paragraph">
<p>You need to also include Log4j 2 dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.11.1</version>
</dependency></code></pre>
</div>
</div>
<div class="paragraph">
<p>And also provide a Log4j 2 configuration file in your classpath.
For example, you can add in your <code>src/main/resources</code> project dir a <code>log4j2.properties</code> file like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties">appender.console.type = Console
appender.console.name = console
appender.console.layout.type = PatternLayout
appender.console.layout.pattern = [%d{ISO8601}][%-5p][%-25c] %marker%m%n

rootLogger.level = info
rootLogger.appenderRef.console.ref = console</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_another_logger">3.3. Using another Logger</h3>
<div class="paragraph">
<p>If you want to use another logger than Log4j 2, you can use <a href="http://www.slf4j.org/">SLF4J</a> bridge to do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-to-slf4j</artifactId>
    <version>2.11.1</version>
</dependency>
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.24</version>
</dependency></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://www.slf4j.org/manual.html">This page</a> lists implementations you can use. Pick your favorite logger
and add it as a dependency. As an example, we will use the <code>slf4j-simple</code> logger:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-simple</artifactId>
    <version>1.7.21</version>
</dependency></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client">4. Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <strong>Java client</strong> in multiple ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform standard <a href="#java-docs-index">index</a>, <a href="#java-docs-get">get</a>,
<a href="#java-docs-delete">delete</a> and <a href="#java-search">search</a> operations on an
existing cluster</p>
</li>
<li>
<p>Perform administrative tasks on a running cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obtaining an Elasticsearch <code>Client</code> is simple. The most common way to
get a client is by creating a <a href="#transport-client"><code>TransportClient</code></a>
that connects to a cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The client must have the same major version (e.g. <code>2.x</code>, or <code>5.x</code>) as the
nodes in the cluster. Clients may connect to clusters which have a different
minor version (e.g. <code>2.3.x</code>) but it is possible that new functionality may not
be supported.  Ideally, the client should have the same version as the
cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="transport-client">4.1. Transport Client</h3>
<div class="paragraph">
<p>deprecated[7.0.0, The <code>TransportClient</code> is deprecated in favour of the {java-rest}/java-rest-high.html[Java High Level REST Client] and will be removed in Elasticsearch 8.0. The {java-rest}/java-rest-high-level-migration.html[migration guide] describes all the steps needed to migrate.]</p>
</div>
<div class="paragraph">
<p>The <code>TransportClient</code> connects remotely to an Elasticsearch cluster
using the transport module. It does not join the cluster, but simply
gets one or more initial transport addresses and communicates with them
in round robin fashion on each action (though most actions will probably
be "two hop" operations).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// on startup

TransportClient client = new PreBuiltTransportClient(Settings.EMPTY)
        .addTransportAddress(new TransportAddress(InetAddress.getByName("host1"), 9300))
        .addTransportAddress(new TransportAddress(InetAddress.getByName("host2"), 9300));

// on shutdown

client.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you have to set the cluster name if you use one different than
"elasticsearch":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Settings settings = Settings.builder()
        .put("cluster.name", "myClusterName").build();
TransportClient client = new PreBuiltTransportClient(settings);
//Add transport addresses and do something with the client...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Transport client comes with a cluster sniffing feature which
allows it to dynamically add new hosts and remove old ones.
When sniffing is enabled, the transport client will connect to the nodes in its
internal node list, which is built via calls to <code>addTransportAddress</code>.
After this, the client will call the internal cluster state API on those nodes
to discover available data nodes. The internal node list of the client will
be replaced with those data nodes only. This list is refreshed every five seconds by default.
Note that the IP addresses the sniffer connects to are the ones declared as the <em>publish</em>
address in those node&#8217;s Elasticsearch config.</p>
</div>
<div class="paragraph">
<p>Keep in mind that the list might possibly not include the original node it connected to
if that node is not a data node. If, for instance, you initially connect to a
master node, after sniffing, no further requests will go to that master node,
but rather to any data nodes instead. The reason the transport client excludes non-data
nodes is to avoid sending search traffic to master only nodes.</p>
</div>
<div class="paragraph">
<p>In order to enable sniffing, set <code>client.transport.sniff</code> to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Settings settings = Settings.builder()
        .put("client.transport.sniff", true).build();
TransportClient client = new PreBuiltTransportClient(settings);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other transport client level settings include:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.ignore_cluster_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to ignore cluster
name validation of connected nodes. (since 0.19.4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.ping_timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time to wait for a ping response
from a node. Defaults to <code>5s</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client.transport.nodes_sampler_interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to sample / ping
the nodes listed and connected. Defaults to <code>5s</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="client-connected-to-client-node">4.2. Connecting a Client to a Coordinating Only Node</h3>
<div class="paragraph">
<p>You can start locally a {ref}/modules-node.html#coordinating-only-node[Coordinating Only Node]
and then simply create a <a href="#transport-client"><code>TransportClient</code></a> in your
application which connects to this Coordinating Only Node.</p>
</div>
<div class="paragraph">
<p>This way, the coordinating only node will be able to load whatever plugin you
need (think about discovery plugins for example).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-docs">5. Document APIs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the following CRUD APIs:</p>
</div>
<div class="ulist">
<div class="title">Single document APIs</div>
<ul>
<li>
<p><a href="#java-docs-index">Index API</a></p>
</li>
<li>
<p><a href="#java-docs-get">Get API</a></p>
</li>
<li>
<p><a href="#java-docs-delete">Delete API</a></p>
</li>
<li>
<p><a href="#java-docs-update">Update API</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Multi-document APIs</div>
<ul>
<li>
<p><a href="#java-docs-multi-get">Multi Get API</a></p>
</li>
<li>
<p><a href="#java-docs-bulk">Bulk API</a></p>
</li>
<li>
<p><a href="#java-docs-reindex">Reindex API</a></p>
</li>
<li>
<p><a href="#java-docs-update-by-query">Update By Query API</a></p>
</li>
<li>
<p><a href="#java-docs-delete-by-query">Delete By Query API</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All CRUD APIs are single-index APIs. The <code>index</code> parameter accepts a single
index name, or an <code>alias</code> which points to a single index.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="java-docs-index">5.1. Index API</h3>
<div class="paragraph">
<p>The index API allows one to index a typed JSON document into a specific
index and make it searchable.</p>
</div>
<div class="sect3">
<h4 id="java-docs-index-generate">5.1.1. Generate JSON document</h4>
<div class="paragraph">
<p>There are several different ways of generating a JSON document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually (aka do it yourself) using native <code>byte[]</code> or as a <code>String</code></p>
</li>
<li>
<p>Using a <code>Map</code> that will be automatically converted to its JSON
equivalent</p>
</li>
<li>
<p>Using a third party library to serialize your beans such as
<a href="https://github.com/FasterXML/jackson">Jackson</a></p>
</li>
<li>
<p>Using built-in helpers XContentFactory.jsonBuilder()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Internally, each type is converted to <code>byte[]</code> (so a String is converted
to a <code>byte[]</code>). Therefore, if the object is in this form already, then
use it. The <code>jsonBuilder</code> is highly optimized JSON generator that
directly constructs a <code>byte[]</code>.</p>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-diy">Do It Yourself</h5>
<div class="paragraph">
<p>Nothing really difficult here but note that you will have to encode
dates according to the
{ref}/mapping-date-format.html[Date Format].</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">String json = "{" +
        "\"user\":\"kimchy\"," +
        "\"postDate\":\"2013-01-30\"," +
        "\"message\":\"trying out Elasticsearch\"" +
    "}";</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-using-map">Using Map</h5>
<div class="paragraph">
<p>Map is a key:values pair collection. It represents a JSON structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Map&lt;String, Object&gt; json = new HashMap&lt;String, Object&gt;();
json.put("user","kimchy");
json.put("postDate",new Date());
json.put("message","trying out Elasticsearch");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-beans">Serialize your beans</h5>
<div class="paragraph">
<p>You can use <a href="https://github.com/FasterXML/jackson">Jackson</a> to serialize
your beans to JSON. Please add <a href="http://search.maven.org/#search%7Cga%7C1%7Cjackson-databind">Jackson Databind</a>
 to your project. Then you can use <code>ObjectMapper</code> to serialize your beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import com.fasterxml.jackson.databind.*;

// instance a json mapper
ObjectMapper mapper = new ObjectMapper(); // create once, reuse

// generate json
byte[] json = mapper.writeValueAsBytes(yourbeaninstance);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-docs-index-generate-helpers">Use Elasticsearch helpers</h5>
<div class="paragraph">
<p>Elasticsearch provides built-in helpers to generate JSON content.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.common.xcontent.XContentFactory.*;

XContentBuilder builder = jsonBuilder()
    .startObject()
        .field("user", "kimchy")
        .field("postDate", new Date())
        .field("message", "trying out Elasticsearch")
    .endObject()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also add arrays with <code>startArray(String)</code> and
<code>endArray()</code> methods. By the way, the <code>field</code> method<br>
 accepts many object types. You can directly pass numbers, dates and even
other XContentBuilder objects.</p>
</div>
<div class="paragraph">
<p>If you need to see the generated JSON content, you can use the
<code>Strings.toString()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.common.Strings;

String json = Strings.toString(builder);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-index-doc">5.1.2. Index document</h4>
<div class="paragraph">
<p>The following example indexes a JSON document into an index called
twitter, under a type called <code>_doc`</code>, with id valued 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.common.xcontent.XContentFactory.*;

IndexResponse response = client.prepareIndex("twitter", "_doc", "1")
        .setSource(jsonBuilder()
                    .startObject()
                        .field("user", "kimchy")
                        .field("postDate", new Date())
                        .field("message", "trying out Elasticsearch")
                    .endObject()
                  )
        .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also index your documents as JSON String and that you
don&#8217;t have to give an ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">String json = "{" +
        "\"user\":\"kimchy\"," +
        "\"postDate\":\"2013-01-30\"," +
        "\"message\":\"trying out Elasticsearch\"" +
    "}";

IndexResponse response = client.prepareIndex("twitter", "_doc")
        .setSource(json, XContentType.JSON)
        .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>IndexResponse</code> object will give you a report:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// Index name
String _index = response.getIndex();
// Type name
String _type = response.getType();
// Document ID (generated or not)
String _id = response.getId();
// Version (if it's the first time you index this document, you will get: 1)
long _version = response.getVersion();
// status has stored current instance statement.
RestStatus status = response.status();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the index operation, check out the REST
{ref}/docs-index_.html[index] docs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-get">5.2. Get API</h3>
<div class="paragraph">
<p>The get API allows to get a typed JSON document from the index based on
its id. The following example gets a JSON document from an index called
twitter, under a type called <code>_doc`</code>, with id valued 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">GetResponse response = client.prepareGet("twitter", "_doc", "1").get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the get operation, check out the REST
{ref}/docs-get.html[get] docs.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-delete">5.3. Delete API</h3>
<div class="paragraph">
<p>The delete API allows one to delete a typed JSON document from a specific
index based on its id. The following example deletes the JSON document
from an index called twitter, under a type called <code>_doc</code>, with id valued
1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">DeleteResponse response = client.prepareDelete("twitter", "_doc", "1").get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on the delete operation, check out the
{ref}/docs-delete.html[delete API] docs.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-delete-by-query">5.4. Delete By Query API</h3>
<div class="paragraph">
<p>The delete by query API allows one to delete a given set of documents based on
the result of a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[delete-by-query-sync]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>index</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>execute the operation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>number of deleted documents</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As it can be a long running operation, if you wish to do it asynchronously, you can call <code>execute</code> instead of <code>get</code>
and provide a listener like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[delete-by-query-async]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>index</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>listener</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>number of deleted documents</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-update">5.5. Update API</h3>
<div class="paragraph">
<p>You can either create an <code>UpdateRequest</code> and send it to the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">UpdateRequest updateRequest = new UpdateRequest();
updateRequest.index("index");
updateRequest.type("_doc");
updateRequest.id("1");
updateRequest.doc(jsonBuilder()
        .startObject()
            .field("gender", "male")
        .endObject());
client.update(updateRequest).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can use <code>prepareUpdate()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.prepareUpdate("ttl", "doc", "1")
        .setScript(new Script(
            "ctx._source.gender = \"male\"", <i class="conum" data-value="1"></i><b>(1)</b>
            ScriptService.ScriptType.INLINE, null, null))
        .get();

client.prepareUpdate("ttl", "doc", "1")
        .setDoc(jsonBuilder()               <i class="conum" data-value="2"></i><b>(2)</b>
            .startObject()
                .field("gender", "male")
            .endObject())
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Your script. It could also be a locally stored script name.
In that case, you&#8217;ll need to use <code>ScriptService.ScriptType.FILE</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Document which will be merged to the existing one.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that you can&#8217;t provide both <code>script</code> and <code>doc</code>.</p>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-script">5.5.1. Update by script</h4>
<div class="paragraph">
<p>The update API allows to update a document based on a script provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">UpdateRequest updateRequest = new UpdateRequest("ttl", "doc", "1")
        .script(new Script("ctx._source.gender = \"male\""));
client.update(updateRequest).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-merge-docs">5.5.2. Update by merging documents</h4>
<div class="paragraph">
<p>The update API also support passing a partial document, which will be merged into the existing document (simple
recursive merge, inner merging of objects, replacing core "keys/values" and arrays). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">UpdateRequest updateRequest = new UpdateRequest("index", "type", "1")
        .doc(jsonBuilder()
            .startObject()
                .field("gender", "male")
            .endObject());
client.update(updateRequest).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-update-api-upsert">5.5.3. Upsert</h4>
<div class="paragraph">
<p>There is also support for <code>upsert</code>. If the document does not exist, the content of the <code>upsert</code>
element will be used to index the fresh doc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IndexRequest indexRequest = new IndexRequest("index", "type", "1")
        .source(jsonBuilder()
            .startObject()
                .field("name", "Joe Smith")
                .field("gender", "male")
            .endObject());
UpdateRequest updateRequest = new UpdateRequest("index", "type", "1")
        .doc(jsonBuilder()
            .startObject()
                .field("gender", "male")
            .endObject())
        .upsert(indexRequest);              <i class="conum" data-value="1"></i><b>(1)</b>
client.update(updateRequest).get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If the document does not exist, the one in <code>indexRequest</code> will be added</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the document <code>index/_doc/1</code> already exists, we will have after this operation a document like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="js">{
    "name"  : "Joe Dalton",
    "gender": "male"        <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This field is added by the update request</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If it does not exist, we will have a new document:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="js">{
    "name" : "Joe Smith",
    "gender": "male"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-multi-get">5.6. Multi Get API</h3>
<div class="paragraph">
<p>The multi get API allows to get a list of documents based on their <code>index</code> and <code>id</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">MultiGetResponse multiGetItemResponses = client.prepareMultiGet()
    .add("twitter", "_doc", "1")            <i class="conum" data-value="1"></i><b>(1)</b>
    .add("twitter", "_doc", "2", "3", "4")  <i class="conum" data-value="2"></i><b>(2)</b>
    .add("another", "_doc", "foo")          <i class="conum" data-value="3"></i><b>(3)</b>
    .get();

for (MultiGetItemResponse itemResponse : multiGetItemResponses) { <i class="conum" data-value="4"></i><b>(4)</b>
    GetResponse response = itemResponse.getResponse();
    if (response.isExists()) {                      <i class="conum" data-value="5"></i><b>(5)</b>
        String json = response.getSourceAsString(); <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>get by a single id</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>or by a list of ids for the same index</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can also get from another index</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>iterate over the result set</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>you can check if the document exists</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>access to the <code>_source</code> field</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on the multi get operation, check out the REST
{ref}/docs-multi-get.html[multi get] docs.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-bulk">5.7. Bulk API</h3>
<div class="paragraph">
<p>The bulk API allows one to index and delete several documents in a
single request. Here is a sample usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.common.xcontent.XContentFactory.*;

BulkRequestBuilder bulkRequest = client.prepareBulk();

// either use client#prepare, or use Requests# to directly build index/delete requests
bulkRequest.add(client.prepareIndex("twitter", "_doc", "1")
        .setSource(jsonBuilder()
                    .startObject()
                        .field("user", "kimchy")
                        .field("postDate", new Date())
                        .field("message", "trying out Elasticsearch")
                    .endObject()
                  )
        );

bulkRequest.add(client.prepareIndex("twitter", "_doc", "2")
        .setSource(jsonBuilder()
                    .startObject()
                        .field("user", "kimchy")
                        .field("postDate", new Date())
                        .field("message", "another post")
                    .endObject()
                  )
        );

BulkResponse bulkResponse = bulkRequest.get();
if (bulkResponse.hasFailures()) {
    // process failures by iterating through each bulk response item
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-bulk-processor">5.8. Using Bulk Processor</h3>
<div class="paragraph">
<p>The <code>BulkProcessor</code> class offers a simple interface to flush bulk operations automatically based on the number or size
of requests, or after a given period.</p>
</div>
<div class="paragraph">
<p>To use it, first create a <code>BulkProcessor</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.action.bulk.BackoffPolicy;
import org.elasticsearch.action.bulk.BulkProcessor;
import org.elasticsearch.common.unit.ByteSizeUnit;
import org.elasticsearch.common.unit.ByteSizeValue;
import org.elasticsearch.common.unit.TimeValue;

BulkProcessor bulkProcessor = BulkProcessor.builder(
        client,  <i class="conum" data-value="1"></i><b>(1)</b>
        new BulkProcessor.Listener() {
            @Override
            public void beforeBulk(long executionId,
                                   BulkRequest request) { ... } <i class="conum" data-value="2"></i><b>(2)</b>

            @Override
            public void afterBulk(long executionId,
                                  BulkRequest request,
                                  BulkResponse response) { ... } <i class="conum" data-value="3"></i><b>(3)</b>

            @Override
            public void afterBulk(long executionId,
                                  BulkRequest request,
                                  Throwable failure) { ... } <i class="conum" data-value="4"></i><b>(4)</b>
        })
        .setBulkActions(10000) <i class="conum" data-value="5"></i><b>(5)</b>
        .setBulkSize(new ByteSizeValue(5, ByteSizeUnit.MB)) <i class="conum" data-value="6"></i><b>(6)</b>
        .setFlushInterval(TimeValue.timeValueSeconds(5)) <i class="conum" data-value="7"></i><b>(7)</b>
        .setConcurrentRequests(1) <i class="conum" data-value="8"></i><b>(8)</b>
        .setBackoffPolicy(
            BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(100), 3)) <i class="conum" data-value="9"></i><b>(9)</b>
        .build();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add your Elasticsearch client</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method is called just before bulk is executed. You can for example see the numberOfActions with
<code>request.numberOfActions()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This method is called after bulk execution. You can for example check if there was some failing requests
with <code>response.hasFailures()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This method is called when the bulk failed and raised a <code>Throwable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We want to execute the bulk every 10 000 requests</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We want to flush the bulk every 5mb</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We want to flush the bulk every 5 seconds whatever the number of requests</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Set the number of concurrent requests. A value of 0 means that only a single request will be allowed to be
executed. A value of 1 means 1 concurrent request is allowed to be executed while accumulating new bulk requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Set a custom backoff policy which will initially wait for 100ms, increase exponentially and retries up to three
times. A retry is attempted whenever one or more bulk item requests have failed with an <code>EsRejectedExecutionException</code>
which indicates that there were too little compute resources available for processing the request. To disable backoff,
pass <code>BackoffPolicy.noBackoff()</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, <code>BulkProcessor</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sets bulkActions to <code>1000</code></p>
</li>
<li>
<p>sets bulkSize to <code>5mb</code></p>
</li>
<li>
<p>does not set flushInterval</p>
</li>
<li>
<p>sets concurrentRequests to 1, which means an asynchronous execution of the flush operation.</p>
</li>
<li>
<p>sets backoffPolicy to an exponential backoff with 8 retries and a start delay of 50ms. The total wait time is roughly 5.1 seconds.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="java-docs-bulk-processor-requests">5.8.1. Add requests</h4>
<div class="paragraph">
<p>Then you can simply add your requests to the <code>BulkProcessor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">bulkProcessor.add(new IndexRequest("twitter", "_doc", "1").source(/* your doc here */));
bulkProcessor.add(new DeleteRequest("twitter", "_doc", "2"));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-bulk-processor-close">5.8.2. Closing the Bulk Processor</h4>
<div class="paragraph">
<p>When all documents are loaded to the <code>BulkProcessor</code> it can be closed by using <code>awaitClose</code> or <code>close</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">bulkProcessor.awaitClose(10, TimeUnit.MINUTES);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">bulkProcessor.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both methods flush any remaining documents and disable all other scheduled flushes if they were scheduled by setting
<code>flushInterval</code>. If concurrent requests were enabled the <code>awaitClose</code> method waits for up to the specified timeout for
all bulk requests to complete then returns <code>true</code>, if the specified waiting time elapses before all bulk requests complete,
<code>false</code> is returned. The <code>close</code> method doesn&#8217;t wait for any remaining bulk requests to complete and exits immediately.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-bulk-processor-tests">5.8.3. Using Bulk Processor in tests</h4>
<div class="paragraph">
<p>If you are running tests with Elasticsearch and are using the <code>BulkProcessor</code> to populate your dataset
you should better set the number of concurrent requests to <code>0</code> so the flush operation of the bulk will be executed
in a synchronous manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">BulkProcessor bulkProcessor = BulkProcessor.builder(client, new BulkProcessor.Listener() { /* Listener methods */ })
        .setBulkActions(10000)
        .setConcurrentRequests(0)
        .build();

// Add your requests
bulkProcessor.add(/* Your requests */);

// Flush any remaining requests
bulkProcessor.flush();

// Or close the bulkProcessor if you don't need it anymore
bulkProcessor.close();

// Refresh your indices
client.admin().indices().prepareRefresh().get();

// Now you can start searching!
client.prepareSearch().get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-docs-bulk-global-parameters">5.8.4. Global Parameters</h4>
<div class="paragraph">
<p>Global parameters can be specified on the BulkRequest as well as BulkProcessor, similar to the REST API. These global
 parameters serve as defaults and can be overridden by local parameters specified on each sub request. Some parameters
 have to be set before any sub request is added - index, type - and you have to specify them during  BulkRequest or
 BulkProcessor creation. Some are optional - pipeline, routing - and can be specified at any point before the bulk is sent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/BulkProcessorIT.java[bulk-processor-mix-parameters]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>global parameters from the BulkRequest will be applied on a sub request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>local pipeline parameter on a sub request will override global parameters from BulkRequest</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/BulkRequestWithGlobalParametersIT.java[bulk-request-mix-pipeline]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>local pipeline parameter on a sub request will override global pipeline from the BulkRequest</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>global parameter from the BulkRequest will be applied on a sub request</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-update-by-query">5.9. Update By Query API</h3>
<div class="paragraph">
<p>The simplest usage of <code>updateByQuery</code> updates each
document in an index without changing the source. This usage enables
picking up a new property or another online mapping change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calls to the <code>updateByQuery</code> API start by getting a snapshot of the index, indexing
any documents found using the <code>internal</code> versioning.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Version conflicts happen when a document changes between the time of the
snapshot and the time the index request processes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the versions match, <code>updateByQuery</code> updates the document
and increments the version number.</p>
</div>
<div class="paragraph">
<p>All update and query failures cause <code>updateByQuery</code> to abort. These failures are
available from the <code>BulkByScrollResponse#getIndexingFailures</code> method. Any
successful updates remain and are not rolled back. While the first failure
causes the abort, the response contains all of the failures generated by the
failed bulk request.</p>
</div>
<div class="paragraph">
<p>To prevent version conflicts from causing <code>updateByQuery</code> to abort, set
<code>abortOnVersionConflict(false)</code>. The first example does this because it is
trying to pick up an online mapping change and a version conflict means that
the conflicting document was updated between the start of the <code>updateByQuery</code>
and the time when it attempted to update the document. This is fine because
that update will have picked up the online mapping update.</p>
</div>
<div class="paragraph">
<p>The <code>UpdateByQueryRequestBuilder</code> API supports filtering the updated documents,
limiting the total number of documents to update, and updating documents
with a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-filter]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>UpdateByQueryRequestBuilder</code> also enables direct access to the query used
to select the documents. You can use this access to change the default scroll size or
otherwise modify the request for matching documents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-size]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also combine <code>size</code> with sorting to limit the documents updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-sort]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to changing the <code>_source</code> field for the document, you can use a
script to change the action, similar to the Update API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-script]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the <a href="#java-docs-update">Update API</a>, you can set the value of <code>ctx.op</code> to change the
operation that executes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>noop</code></dt>
<dd>
<p>Set <code>ctx.op = "noop"</code> if your script doesn&#8217;t make any
changes. The <code>updateByQuery</code> operation then omits that document from the updates.
This behavior increments the <code>noop</code> counter in the response body.</p>
</dd>
<dt class="hdlist1"><code>delete</code></dt>
<dd>
<p>Set <code>ctx.op = "delete"</code> if your script decides that the document must be
deleted. The deletion will be reported in the <code>deleted</code> counter in the
response body.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Setting <code>ctx.op</code> to any other value generates an error. Setting any
other field in <code>ctx</code> generates an error.</p>
</div>
<div class="paragraph">
<p>This API doesn&#8217;t allow you to move the documents it touches, just modify their
source. This is intentional! We&#8217;ve made no provisions for removing the document
from its original location.</p>
</div>
<div class="paragraph">
<p>You can also perform these operations on multiple indices at once, similar to the search API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-multi-index]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you provide a <code>routing</code> value then the process copies the routing value to the scroll query,
limiting the process to the shards that match that routing value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-routing]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>updateByQuery</code> can also use the ingest node by
specifying a <code>pipeline</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-pipeline]</code></pre>
</div>
</div>
<h3 id="java-docs-update-by-query-task-api" class="float">Works with the Task API</h3>
<div class="paragraph">
<p>You can fetch the status of all running update-by-query requests with the Task API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-list-tasks]</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <code>TaskId</code> shown above you can look up the task directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-get-task]</code></pre>
</div>
</div>
<h3 id="java-docs-update-by-query-cancel-task-api" class="float">Works with the Cancel Task API</h3>
<div class="paragraph">
<p>Any Update By Query can be canceled using the Task Cancel API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-cancel-task]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>list tasks</code> API to find the value of <code>taskId</code>.</p>
</div>
<div class="paragraph">
<p>Cancelling a request is typically a very fast process but can take up to a few seconds.
The task status API continues to list the task until the cancellation is complete.</p>
</div>
<h3 id="java-docs-update-by-query-rethrottle" class="float">Rethrottling</h3>
<div class="paragraph">
<p>Use the <code>_rethrottle</code> API to change the value of <code>requests_per_second</code> on a running update:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[update-by-query-rethrottle]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>list tasks</code> API to find the value of <code>taskId</code>.</p>
</div>
<div class="paragraph">
<p>As with the <code>updateByQuery</code> API, the value of <code>requests_per_second</code>
can be any positive float value to set the level of the throttle, or <code>Float.POSITIVE_INFINITY</code> to disable throttling.
A value of <code>requests_per_second</code> that speeds up the process takes
effect immediately. <code>requests_per_second</code> values that slow the query take effect
after completing the current batch in order to prevent scroll timeouts.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-docs-reindex">5.10. Reindex API</h3>
<div class="paragraph">
<p>See {ref}/docs-reindex.html[reindex API].</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../modules/reindex/src/test/java/org/elasticsearch/client/documentation/ReindexDocumentationIT.java[reindex1]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionally a query can provided to filter what documents should be
re-indexed from the source to the target index.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-search">6. Search API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The search API allows one to execute a search query and get back search hits
that match the query. It can be executed across one or more indices and
across one or more types. The query can be provided using the <a href="#java-query-dsl">query Java API</a>.
The body of the search request is built using the <code>SearchSourceBuilder</code>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.action.search.SearchResponse;
import org.elasticsearch.action.search.SearchType;
import org.elasticsearch.index.query.QueryBuilders.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse response = client.prepareSearch("index1", "index2")
        .setSearchType(SearchType.DFS_QUERY_THEN_FETCH)
        .setQuery(QueryBuilders.termQuery("multi", "test"))                 // Query
        .setPostFilter(QueryBuilders.rangeQuery("age").from(12).to(18))     // Filter
        .setFrom(0).setSize(60).setExplain(true)
        .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that all parameters are optional. Here is the smallest search call
you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// MatchAll on the whole cluster with all default options
SearchResponse response = client.prepareSearch().get();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the Java API defines the additional search types QUERY_AND_FETCH and
        DFS_QUERY_AND_FETCH, these modes are internal optimizations and should not
        be specified explicitly by users of the API.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on the search operation, check out the REST
{ref}/search.html[search] docs.</p>
</div>
<div class="sect2">
<h3 id="java-search-scrolling">6.1. Using scrolls in Java</h3>
<div class="paragraph">
<p>Read the {ref}/search-request-scroll.html[scroll documentation]
first!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.index.query.QueryBuilders.*;

QueryBuilder qb = termQuery("multi", "test");

SearchResponse scrollResp = client.prepareSearch(test)
        .addSort(FieldSortBuilder.DOC_FIELD_NAME, SortOrder.ASC)
        .setScroll(new TimeValue(60000))
        .setQuery(qb)
        .setSize(100).get(); //max of 100 hits will be returned for each scroll
//Scroll until no hits are returned
do {
    for (SearchHit hit : scrollResp.getHits().getHits()) {
        //Handle the hit...
    }

    scrollResp = client.prepareSearchScroll(scrollResp.getScrollId()).setScroll(new TimeValue(60000)).execute().actionGet();
} while(scrollResp.getHits().getHits().length != 0); // Zero hits mark the end of the scroll and the while loop.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-search-msearch">6.2. MultiSearch API</h3>
<div class="paragraph">
<p>See {ref}/search-multi-search.html[MultiSearch API Query]
documentation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchRequestBuilder srb1 = client
    .prepareSearch().setQuery(QueryBuilders.queryStringQuery("elasticsearch")).setSize(1);
SearchRequestBuilder srb2 = client
    .prepareSearch().setQuery(QueryBuilders.matchQuery("name", "kimchy")).setSize(1);

MultiSearchResponse sr = client.prepareMultiSearch()
        .add(srb1)
        .add(srb2)
        .get();

// You will get all individual responses from MultiSearchResponse#getResponses()
long nbHits = 0;
for (MultiSearchResponse.Item item : sr.getResponses()) {
    SearchResponse response = item.getResponse();
    nbHits += response.getHits().getTotalHits().value;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-search-aggs">6.3. Using Aggregations</h3>
<div class="paragraph">
<p>The following code shows how to add two aggregations within your search:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = client.prepareSearch()
    .setQuery(QueryBuilders.matchAllQuery())
    .addAggregation(
            AggregationBuilders.terms("agg1").field("field")
    )
    .addAggregation(
            AggregationBuilders.dateHistogram("agg2")
                    .field("birth")
                    .dateHistogramInterval(DateHistogramInterval.YEAR)
    )
    .get();

// Get your facet results
Terms agg1 = sr.getAggregations().get("agg1");
Histogram agg2 = sr.getAggregations().get("agg2");</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#java-aggs">Aggregations Java API</a>
documentation for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-search-terminate-after">6.4. Terminate After</h3>
<div class="paragraph">
<p>The maximum number of documents to collect for each shard, upon reaching which the query execution will terminate early.
If set, you will be able to check if the operation terminated early by asking for <code>isTerminatedEarly()</code> in the
<code>SearchResponse</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = client.prepareSearch(INDEX)
    .setTerminateAfter(1000)    <i class="conum" data-value="1"></i><b>(1)</b>
    .get();

if (sr.isTerminatedEarly()) {
    // We finished early
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Finish after 1000 docs</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java-search-template">6.5. Search Template</h3>
<div class="paragraph">
<p>See {ref}/search-template.html[Search Template] documentation</p>
</div>
<div class="paragraph">
<p>Define your template parameters as a <code>Map&lt;String,Object&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Map&lt;String, Object&gt; template_params = new HashMap&lt;&gt;();
template_params.put("param_gender", "male");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use your stored search templates in <code>config/scripts</code>.
For example, if you have a file named <code>config/scripts/template_gender.mustache</code> containing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="js">{
    "query" : {
        "match" : {
            "gender" : "{{param_gender}}"
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create your search template request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = new SearchTemplateRequestBuilder(client)
    .setScript("template_gender")                 <i class="conum" data-value="1"></i><b>(1)</b>
    .setScriptType(ScriptService.ScriptType.FILE) <i class="conum" data-value="2"></i><b>(2)</b>
    .setScriptParams(template_params)             <i class="conum" data-value="3"></i><b>(3)</b>
    .setRequest(new SearchRequest())              <i class="conum" data-value="4"></i><b>(4)</b>
    .get()                                        <i class="conum" data-value="5"></i><b>(5)</b>
    .getResponse();                               <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>template name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>template stored on disk in <code>gender_template.mustache</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>set the execution context (ie. define the index name here)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>execute and get the template response</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>get from the template response the search response itself</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also store your template in the cluster state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().cluster().preparePutStoredScript()
    .setScriptLang("mustache")
    .setId("template_gender")
    .setSource(new BytesArray(
        "{\n" +
        "    \"query\" : {\n" +
        "        \"match\" : {\n" +
        "            \"gender\" : \"{{param_gender}}\"\n" +
        "        }\n" +
        "    }\n" +
        "}")).get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute a stored templates, use <code>ScriptService.ScriptType.STORED</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = new SearchTemplateRequestBuilder(client)
        .setScript("template_gender")         <i class="conum" data-value="1"></i><b>(1)</b>
        .setScriptType(ScriptType.STORED)     <i class="conum" data-value="2"></i><b>(2)</b>
        .setScriptParams(template_params)     <i class="conum" data-value="3"></i><b>(3)</b>
        .setRequest(new SearchRequest())      <i class="conum" data-value="4"></i><b>(4)</b>
        .get()                                <i class="conum" data-value="5"></i><b>(5)</b>
        .getResponse();                       <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>template name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>template stored in the cluster state</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>set the execution context (ie. define the index name here)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>execute and get the template response</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>get from the template response the search response itself</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also execute inline templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">sr = new SearchTemplateRequestBuilder(client)
        .setScript("{\n" +                   <i class="conum" data-value="1"></i><b>(1)</b>
                "        \"query\" : {\n" +
                "            \"match\" : {\n" +
                "                \"gender\" : \"{{param_gender}}\"\n" +
                "            }\n" +
                "        }\n" +
                "}")
        .setScriptType(ScriptType.INLINE)    <i class="conum" data-value="2"></i><b>(2)</b>
        .setScriptParams(template_params)    <i class="conum" data-value="3"></i><b>(3)</b>
        .setRequest(new SearchRequest())     <i class="conum" data-value="4"></i><b>(4)</b>
        .get()                               <i class="conum" data-value="5"></i><b>(5)</b>
        .getResponse();                      <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>template&#8217;s body</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>template is passed inline</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>set the execution context (ie. define the index name here)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>execute and get the template response</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>get from the template response the search response itself</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-aggs">7. Aggregations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java API to play with aggregations. See the
{ref}/search-aggregations.html[Aggregations guide].</p>
</div>
<div class="paragraph">
<p>Use the factory for aggregation builders (<code>AggregationBuilders</code>) and add each aggregation
you want to compute when querying and add it to your search request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = node.client().prepareSearch()
        .setQuery( /* your query */ )
        .addAggregation( /* add an aggregation */ )
        .execute().actionGet();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can add more than one aggregation. See
{ref}/search-search.html[Search Java API] for details.</p>
</div>
<div class="paragraph">
<p>To build aggregation requests, use <code>AggregationBuilders</code> helpers. Just import them
in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.AggregationBuilders;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_structuring_aggregations">7.1. Structuring aggregations</h3>
<div class="paragraph">
<p>As explained in the
{ref}/search-aggregations.html[Aggregations guide], you can define
sub aggregations inside an aggregation.</p>
</div>
<div class="paragraph">
<p>An aggregation could be a metrics aggregation or a bucket aggregation.</p>
</div>
<div class="paragraph">
<p>For example, here is a 3 levels aggregation composed of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Terms aggregation (bucket)</p>
</li>
<li>
<p>Date Histogram aggregation (bucket)</p>
</li>
<li>
<p>Average aggregation (metric)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SearchResponse sr = node.client().prepareSearch()
    .addAggregation(
        AggregationBuilders.terms("by_country").field("country")
        .subAggregation(AggregationBuilders.dateHistogram("by_year")
            .field("dateOfBirth")
            .dateHistogramInterval(DateHistogramInterval.YEAR)
            .subAggregation(AggregationBuilders.avg("avg_children").field("children"))
        )
    )
    .execute().actionGet();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metrics_aggregations">7.2. Metrics aggregations</h3>
<div class="sect3">
<h4 id="java-aggs-metrics-min">7.2.1. Min Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-min-aggregation.html[Min Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">MinAggregationBuilder aggregation =
        AggregationBuilders
                .min("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.min.Min;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Min agg = sr.getAggregations().get("agg");
double value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-max">7.2.2. Max Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-max-aggregation.html[Max Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_2">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">MaxAggregationBuilder aggregation =
        AggregationBuilders
                .max("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_2">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.max.Max;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Max agg = sr.getAggregations().get("agg");
double value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-sum">7.2.3. Sum Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-sum-aggregation.html[Sum Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_3">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">SumAggregationBuilder aggregation =
        AggregationBuilders
                .sum("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_3">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.sum.Sum;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Sum agg = sr.getAggregations().get("agg");
double value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-avg">7.2.4. Avg Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-avg-aggregation.html[Avg Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_4">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AvgAggregationBuilder aggregation =
        AggregationBuilders
                .avg("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_4">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.avg.Avg;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Avg agg = sr.getAggregations().get("agg");
double value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-stats">7.2.5. Stats Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-stats-aggregation.html[Stats Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_5">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">StatsAggregationBuilder aggregation =
        AggregationBuilders
                .stats("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_5">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.stats.Stats;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Stats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-extendedstats">7.2.6. Extended Stats Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-extendedstats-aggregation.html[Extended Stats Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_6">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ExtendedStatsAggregationBuilder aggregation =
        AggregationBuilders
                .extendedStats("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_6">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.stats.extended.ExtendedStats;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
ExtendedStats agg = sr.getAggregations().get("agg");
double min = agg.getMin();
double max = agg.getMax();
double avg = agg.getAvg();
double sum = agg.getSum();
long count = agg.getCount();
double stdDeviation = agg.getStdDeviation();
double sumOfSquares = agg.getSumOfSquares();
double variance = agg.getVariance();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-valuecount">7.2.7. Value Count Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-valuecount-aggregation.html[Value Count Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_7">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ValueCountAggregationBuilder aggregation =
        AggregationBuilders
                .count("agg")
                .field("height");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_7">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.valuecount.ValueCount;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
ValueCount agg = sr.getAggregations().get("agg");
long value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-percentile">7.2.8. Percentile Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-percentile-aggregation.html[Percentile Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_8">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">PercentilesAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide your own percentiles instead of using defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">PercentilesAggregationBuilder aggregation =
        AggregationBuilders
                .percentiles("agg")
                .field("height")
                .percentiles(1.0, 5.0, 10.0, 20.0, 30.0, 75.0, 95.0, 99.0);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_8">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.Percentiles;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Percentiles agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">percent [1.0], value [0.814338896154595]
percent [5.0], value [0.8761912455821302]
percent [25.0], value [1.173346540141847]
percent [50.0], value [1.5432023318692198]
percent [75.0], value [1.923915462033674]
percent [95.0], value [2.2273644908535335]
percent [99.0], value [2.284989339108279]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-percentile-rank">7.2.9. Percentile Ranks Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-percentile-rank-aggregation.html[Percentile Ranks Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_9">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">PercentileRanksAggregationBuilder aggregation =
        AggregationBuilders
                .percentileRanks("agg")
                .field("height")
                .values(1.24, 1.91, 2.22);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_9">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.percentiles.Percentile;
import org.elasticsearch.search.aggregations.metrics.percentiles.PercentileRanks;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
PercentileRanks agg = sr.getAggregations().get("agg");
// For each entry
for (Percentile entry : agg) {
    double percent = entry.getPercent();    // Percent
    double value = entry.getValue();        // Value

    logger.info("percent [{}], value [{}]", percent, value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">percent [29.664353095090945], value [1.24]
percent [73.9335313461868], value [1.91]
percent [94.40095147327283], value [2.22]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-cardinality">7.2.10. Cardinality Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-cardinality-aggregation.html[Cardinality Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_10">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CardinalityAggregationBuilder aggregation =
        AggregationBuilders
                .cardinality("agg")
                .field("tags");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_10">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.cardinality.Cardinality;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Cardinality agg = sr.getAggregations().get("agg");
long value = agg.getValue();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-geobounds">7.2.11. Geo Bounds Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-geobounds-aggregation.html[Geo Bounds Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_11">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">GeoBoundsAggregationBuilder aggregation =
        GeoBoundsAggregationBuilder
                .geoBounds("agg")
                .field("address.location")
                .wrapLongitude(true);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_11">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.metrics.geobounds.GeoBounds;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
GeoBounds agg = sr.getAggregations().get("agg");
GeoPoint bottomRight = agg.bottomRight();
GeoPoint topLeft = agg.topLeft();
logger.info("bottomRight {}, topLeft {}", bottomRight, topLeft);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">bottomRight [40.70500764381921, 13.952946866893775], topLeft [53.49603022435221, -4.190029308156676]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-tophits">7.2.12. Top Hits Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-top-hits-aggregation.html[Top Hits Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_12">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use most of the options available for standard search such as <code>from</code>, <code>size</code>, <code>sort</code>, <code>highlight</code>, <code>explain</code>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .terms("agg").field("gender")
        .subAggregation(
            AggregationBuilders.topHits("top")
                .explain(true)
                .size(1)
                .from(10)
        );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_12">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Terms agg = sr.getAggregations().get("agg");

// For each entry
for (Terms.Bucket entry : agg.getBuckets()) {
    String key = entry.getKey();                    // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);

    // We ask for top_hits for each bucket
    TopHits topHits = entry.getAggregations().get("top");
    for (SearchHit hit : topHits.getHits().getHits()) {
        logger.info(" -&gt; id [{}], _source [{}]", hit.getId(), hit.getSourceAsString());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [male], doc_count [5107]
 -&gt; id [AUnzSZze9k7PKXtq04x2], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzj9k7PKXtq04x4], _source [{"gender":"male",...}]
 -&gt; id [AUnzSZzl9k7PKXtq04x5], _source [{"gender":"male",...}]
key [female], doc_count [4893]
 -&gt; id [AUnzSZzM9k7PKXtq04xy], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZzp9k7PKXtq04x8], _source [{"gender":"female",...}]
 -&gt; id [AUnzSZ0W9k7PKXtq04yS], _source [{"gender":"female",...}]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-metrics-scripted-metric">7.2.13. Scripted Metric Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-metrics-scripted-metric-aggregation.html[Scripted Metric Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_13">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify a <code>combine</code> script which will be executed on each shard:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"))
    .combineScript(new Script("double heights_sum = 0.0; for (t in state.heights) { heights_sum += t } return heights_sum"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify a <code>reduce</code> script which will be executed on the node which gets the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ScriptedMetricAggregationBuilder aggregation = AggregationBuilders
    .scriptedMetric("agg")
    .initScript(new Script("state.heights = []"))
    .mapScript(new Script("state.heights.add(doc.gender.value == 'male' ? doc.height.value : -1.0 * doc.height.value)"))
    .combineScript(new Script("double heights_sum = 0.0; for (t in state.heights) { heights_sum += t } return heights_sum"))
    .reduceScript(new Script("double heights_sum = 0.0; for (a in states) { heights_sum += a } return heights_sum"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_13">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;
import org.elasticsearch.search.aggregations.metrics.tophits.TopHits;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
ScriptedMetric agg = sr.getAggregations().get("agg");
Object scriptedResult = agg.aggregation();
logger.info("scriptedResult [{}]", scriptedResult);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the result depends on the script you built.
For the first example, this will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">scriptedResult object [ArrayList]
scriptedResult [ {
"heights" : [ 1.122218480146643, -1.8148918111233887, -1.7626731575142909, ... ]
}, {
"heights" : [ -0.8046067304119863, -2.0785486707864553, -1.9183567430207953, ... ]
}, {
"heights" : [ 2.092635728868694, 1.5697545960886536, 1.8826954461968808, ... ]
}, {
"heights" : [ -2.1863201099468403, 1.6328549117346856, -1.7078288405893842, ... ]
}, {
"heights" : [ 1.6043904836424177, -2.0736538674414025, 0.9898266674373053, ... ]
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second example will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">scriptedResult object [ArrayList]
scriptedResult [-41.279615707402876,
                -60.88007362339038,
                38.823270659734256,
                14.840192739445632,
                11.300902755741326]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last example will produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">scriptedResult object [Double]
scriptedResult [2.171917696507009]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bucket_aggregations">7.3. Bucket aggregations</h3>
<div class="sect3">
<h4 id="java-aggs-bucket-global">7.3.1. Global Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-global-aggregation.html[Global Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_14">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .global("agg")
    .subAggregation(AggregationBuilders.terms("genders").field("gender"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_14">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.global.Global;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Global agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-filter">7.3.2. Filter Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-filter-aggregation.html[Filter Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_15">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .filter("agg", QueryBuilders.termQuery("gender", "male"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_15">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.filter.Filter;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Filter agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-filters">7.3.3. Filters Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-filters-aggregation.html[Filters Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_16">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .filters("agg",
            new FiltersAggregator.KeyedFilter("men", QueryBuilders.termQuery("gender", "male")),
            new FiltersAggregator.KeyedFilter("women", QueryBuilders.termQuery("gender", "female")));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_16">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.filters.Filters;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Filters agg = sr.getAggregations().get("agg");

// For each entry
for (Filters.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();            // bucket key
    long docCount = entry.getDocCount();            // Doc count
    logger.info("key [{}], doc_count [{}]", key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [men], doc_count [4982]
key [women], doc_count [5018]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-missing">7.3.4. Missing Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-missing-aggregation.html[Missing Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_17">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders.missing("agg").field("gender");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_17">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.missing.Missing;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Missing agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-nested">7.3.5. Nested Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-nested-aggregation.html[Nested Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_18">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .nested("agg", "resellers");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_18">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-reverse-nested">7.3.6. Reverse Nested Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-reverse-nested-aggregation.html[Reverse Nested Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_19">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .nested("agg", "resellers")
        .subAggregation(
                AggregationBuilders
                        .terms("name").field("resellers.name")
                        .subAggregation(
                                AggregationBuilders
                                        .reverseNested("reseller_to_product")
                        )
        );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_19">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.nested.Nested;
import org.elasticsearch.search.aggregations.bucket.nested.ReverseNested;
import org.elasticsearch.search.aggregations.bucket.terms.Terms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Nested agg = sr.getAggregations().get("agg");
Terms name = agg.getAggregations().get("name");
for (Terms.Bucket bucket : name.getBuckets()) {
    ReverseNested resellerToProduct = bucket.getAggregations().get("reseller_to_product");
    resellerToProduct.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-children">7.3.7. Children Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-children-aggregation.html[Children Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_20">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
    AggregationBuilders
        .children("agg", "reseller"); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>"agg"</code> is the name of the aggregation and <code>"reseller"</code> is the child type</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_20">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.join.aggregations.Children;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Children agg = sr.getAggregations().get("agg");
agg.getDocCount(); // Doc count</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-terms">7.3.8. Terms Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-terms-aggregation.html[Terms Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_21">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_21">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.terms.Terms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Terms genders = sr.getAggregations().get("genders");

// For each entry
for (Terms.Bucket entry : genders.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_order">Order</h5>
<div class="paragraph">
<p>Import bucket ordering strategy classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.BucketOrder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets by their <code>doc_count</code> in an ascending manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.count(true))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets alphabetically by their terms in an ascending manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.key(true))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.aggregation("avg_height", false))
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ordering the buckets by multiple criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilders
    .terms("genders")
    .field("gender")
    .order(BucketOrder.compound( // in order of priority:
        BucketOrder.aggregation("avg_height", false), // sort by sub-aggregation first
        BucketOrder.count(true))) // then bucket count as a tie-breaker
    .subAggregation(
        AggregationBuilders.avg("avg_height").field("height")
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-significantterms">7.3.9. Significant Terms Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-significantterms-aggregation.html[Significant Terms Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_22">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .significantTerms("significant_countries")
                .field("address.country");

// Let say you search for men only
SearchResponse sr = client.prepareSearch()
        .setQuery(QueryBuilders.termQuery("gender", "male"))
        .addAggregation(aggregation)
        .get();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_22">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.significant.SignificantTerms;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
SignificantTerms agg = sr.getAggregations().get("significant_countries");

// For each entry
for (SignificantTerms.Bucket entry : agg.getBuckets()) {
    entry.getKey();      // Term
    entry.getDocCount(); // Doc count
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-range">7.3.10. Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-range-aggregation.html[Range Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_23">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .range("agg")
                .field("height")
                .addUnboundedTo(1.0f)               // from -infinity to 1.0 (excluded)
                .addRange(1.0f, 1.5f)               // from 1.0 to 1.5 (excluded)
                .addUnboundedFrom(1.5f);            // from 1.5 to +infinity</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_23">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();             // Range as key
    Number from = (Number) entry.getFrom();          // Bucket from
    Number to = (Number) entry.getTo();              // Bucket to
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [*-1.0], from [-Infinity], to [1.0], doc_count [9]
key [1.0-1.5], from [1.0], to [1.5], doc_count [21]
key [1.5-*], from [1.5], to [Infinity], doc_count [20]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-daterange">7.3.11. Date Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-daterange-aggregation.html[Date Range Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_24">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateRange("agg")
                .field("dateOfBirth")
                .format("yyyy")
                .addUnboundedTo("1950")    // from -infinity to 1950 (excluded)
                .addRange("1950", "1960")  // from 1950 to 1960 (excluded)
                .addUnboundedFrom("1960"); // from 1960 to +infinity</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_24">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();                // Date range as key
    DateTime fromAsDate = (DateTime) entry.getFrom();   // Date bucket from as a Date
    DateTime toAsDate = (DateTime) entry.getTo();       // Date bucket to as a Date
    long docCount = entry.getDocCount();                // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsDate, toAsDate, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [*-1950], from [null], to [1950-01-01T00:00:00.000Z], doc_count [8]
key [1950-1960], from [1950-01-01T00:00:00.000Z], to [1960-01-01T00:00:00.000Z], doc_count [5]
key [1960-*], from [1960-01-01T00:00:00.000Z], to [null], doc_count [37]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-iprange">7.3.12. Ip Range Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-iprange-aggregation.html[Ip Range Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_25">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder&lt;?&gt; aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addUnboundedTo("192.168.1.0")             // from -infinity to 192.168.1.0 (excluded)
                .addRange("192.168.1.0", "192.168.2.0")    // from 192.168.1.0 to 192.168.2.0 (excluded)
                .addUnboundedFrom("192.168.2.0");          // from 192.168.2.0 to +infinity</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you could also use ip masks as ranges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder&lt;?&gt; aggregation =
        AggregationBuilders
                .ipRange("agg")
                .field("ip")
                .addMaskRange("192.168.0.0/32")
                .addMaskRange("192.168.0.0/24")
                .addMaskRange("192.168.0.0/16");</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_25">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();            // Ip range as key
    String fromAsString = entry.getFromAsString();  // Ip bucket from as a String
    String toAsString = entry.getToAsString();      // Ip bucket to as a String
    long docCount = entry.getDocCount();            // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, fromAsString, toAsString, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [*-192.168.1.0], from [null], to [192.168.1.0], doc_count [13]
key [192.168.1.0-192.168.2.0], from [192.168.1.0], to [192.168.2.0], doc_count [14]
key [192.168.2.0-*], from [192.168.2.0], to [null], doc_count [23]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And for the second one (using Ip masks):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [192.168.0.0/32], from [192.168.0.0], to [192.168.0.1], doc_count [0]
key [192.168.0.0/24], from [192.168.0.0], to [192.168.1.0], doc_count [13]
key [192.168.0.0/16], from [192.168.0.0], to [192.169.0.0], doc_count [50]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-histogram">7.3.13. Histogram Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-histogram-aggregation.html[Histogram Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_26">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .histogram("agg")
                .field("height")
                .interval(1);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_26">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    Number key = (Number) entry.getKey();   // Key
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], doc_count [{}]", key, docCount);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_order_2">Order</h5>
<div class="paragraph">
<p>Supports the same order functionality as the <a href="#java-aggs-bucket-terms"><code>Terms Aggregation</code></a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-datehistogram">7.3.14. Date Histogram Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-datehistogram-aggregation.html[Date Histogram Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_27">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .dateHistogramInterval(DateHistogramInterval.YEAR);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if you want to set an interval of 10 days:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .dateHistogram("agg")
                .field("dateOfBirth")
                .dateHistogramInterval(DateHistogramInterval.days(10));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_27">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.histogram.Histogram;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Histogram agg = sr.getAggregations().get("agg");

// For each entry
for (Histogram.Bucket entry : agg.getBuckets()) {
    DateTime key = (DateTime) entry.getKey();    // Key
    String keyAsString = entry.getKeyAsString(); // Key as String
    long docCount = entry.getDocCount();         // Doc count

    logger.info("key [{}], date [{}], doc_count [{}]", keyAsString, key.getYear(), docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce for the first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [1942-01-01T00:00:00.000Z], date [1942], doc_count [1]
key [1945-01-01T00:00:00.000Z], date [1945], doc_count [1]
key [1946-01-01T00:00:00.000Z], date [1946], doc_count [1]
...
key [2005-01-01T00:00:00.000Z], date [2005], doc_count [1]
key [2007-01-01T00:00:00.000Z], date [2007], doc_count [2]
key [2008-01-01T00:00:00.000Z], date [2008], doc_count [3]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_order_3">Order</h5>
<div class="paragraph">
<p>Supports the same order functionality as the <a href="#java-aggs-bucket-terms"><code>Terms Aggregation</code></a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-geodistance">7.3.15. Geo Distance Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-geodistance-aggregation.html[Geo Distance Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_28">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geoDistance("agg", new GeoPoint(48.84237171118314,2.33320027692004))
                .field("address.location")
                .unit(DistanceUnit.KILOMETERS)
                .addUnboundedTo(3.0)
                .addRange(3.0, 10.0)
                .addRange(10.0, 500.0);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_28">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.range.Range;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
Range agg = sr.getAggregations().get("agg");

// For each entry
for (Range.Bucket entry : agg.getBuckets()) {
    String key = entry.getKeyAsString();    // key as String
    Number from = (Number) entry.getFrom(); // bucket from value
    Number to = (Number) entry.getTo();     // bucket to value
    long docCount = entry.getDocCount();    // Doc count

    logger.info("key [{}], from [{}], to [{}], doc_count [{}]", key, from, to, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [*-3.0], from [0.0], to [3.0], doc_count [161]
key [3.0-10.0], from [3.0], to [10.0], doc_count [460]
key [10.0-500.0], from [10.0], to [500.0], doc_count [4925]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-aggs-bucket-geohashgrid">7.3.16. Geo Hash Grid Aggregation</h4>
<div class="paragraph">
<p>Here is how you can use
{ref}/search-aggregations-bucket-geohashgrid-aggregation.html[Geo Hash Grid Aggregation]
with Java API.</p>
</div>
<div class="sect4">
<h5 id="_prepare_aggregation_request_29">Prepare aggregation request</h5>
<div class="paragraph">
<p>Here is an example on how to create the aggregation request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AggregationBuilder aggregation =
        AggregationBuilders
                .geohashGrid("agg")
                .field("address.location")
                .precision(4);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_use_aggregation_response_29">Use aggregation response</h5>
<div class="paragraph">
<p>Import Aggregation definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import org.elasticsearch.search.aggregations.bucket.geogrid.GeoHashGrid;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// sr is here your SearchResponse object
GeoHashGrid agg = sr.getAggregations().get("agg");

// For each entry
for (GeoHashGrid.Bucket entry : agg.getBuckets()) {
    String keyAsString = entry.getKeyAsString(); // key as String
    GeoPoint key = (GeoPoint) entry.getKey();    // key as geo point
    long docCount = entry.getDocCount();         // Doc count

    logger.info("key [{}], point {}, doc_count [{}]", keyAsString, key, docCount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will basically produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text">key [gbqu], point [47.197265625, -1.58203125], doc_count [1282]
key [gbvn], point [50.361328125, -4.04296875], doc_count [1248]
key [u1j0], point [50.712890625, 7.20703125], doc_count [1156]
key [u0j2], point [45.087890625, 7.55859375], doc_count [1138]
...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-query-dsl">8. Query DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java query dsl in a similar manner to the
REST {ref}/query-dsl.html[Query DSL]. The factory for query
builders is <code>QueryBuilders</code>. Once your query is ready, you can use the
<a href="#java-search">Search API</a>.</p>
</div>
<div class="paragraph">
<p>To use <code>QueryBuilders</code> just import them in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.index.query.QueryBuilders.*;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can easily print (aka debug) JSON generated queries using
<code>toString()</code> method on <code>QueryBuilder</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>QueryBuilder</code> can then be used with any API that accepts a query,
such as <code>count</code> and <code>search</code>.</p>
</div>
<div class="sect2">
<h3 id="java-query-dsl-match-all-query">8.1. Match All Query</h3>
<div class="paragraph">
<p>See {ref}/query-dsl-match-all-query.html[Match All Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[match_all]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-full-text-queries">8.2. Full text queries</h3>
<div class="paragraph">
<p>The high-level full text queries are usually used for running full text
queries on full text fields like the body of an email. They understand how the
field being queried is analyzed and will apply each field&#8217;s
<code>analyzer</code> (or <code>search_analyzer</code>) to the query string before executing.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-match-query"><code>match</code> query</a></dt>
<dd>
<p>The standard query for performing full text queries, including fuzzy matching
and phrase or proximity queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-multi-match-query"><code>multi_match</code> query</a></dt>
<dd>
<p>The multi-field version of the <code>match</code> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-common-terms-query"><code>common_terms</code> query</a></dt>
<dd>
<p>A more specialized query which gives more preference to uncommon words.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-query-string-query"><code>query_string</code> query</a></dt>
<dd>
<p>Supports the compact Lucene query string syntax,
allowing you to specify AND|OR|NOT conditions and multi-field search
within a single query string. For expert users only.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-simple-query-string-query"><code>simple_query_string</code></a></dt>
<dd>
<p>A simpler, more robust version of the <code>query_string</code> syntax suitable
for exposing directly to users.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-match-query">8.2.1. Match Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-match-query.html[Match Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[match]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-multi-match-query">8.2.2. Multi Match Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-multi-match-query.html[Multi Match Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[multi_match]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>text</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>fields</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-common-terms-query">8.2.3. Common Terms Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-common-terms-query.html[Common Terms Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[common_terms]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-query-string-query">8.2.4. Query String Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-query-string-query.html[Query String Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[query_string]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-simple-query-string-query">8.2.5. Simple Query String Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-simple-query-string-query.html[Simple Query String Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[simple_query_string]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-term-level-queries">8.3. Term level queries</h3>
<div class="paragraph">
<p>While the <a href="#java-full-text-queries">full text queries</a> will analyze the query
string before executing, the <em>term-level queries</em> operate on the exact terms
that are stored in the inverted index.</p>
</div>
<div class="paragraph">
<p>These queries are usually used for structured data like numbers, dates, and
enums, rather than full text fields.  Alternatively, they allow you to craft
low-level queries, foregoing the analysis process.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-term-query"><code>term</code> query</a></dt>
<dd>
<p>Find documents which contain the exact term specified in the field
specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-terms-query"><code>terms</code> query</a></dt>
<dd>
<p>Find documents which contain any of the exact terms specified in the field
specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-range-query"><code>range</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains values (dates, numbers,
or strings) in the range specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-exists-query"><code>exists</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains any non-null value.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-prefix-query"><code>prefix</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which being with
the exact prefix specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-wildcard-query"><code>wildcard</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which match the
pattern specified, where the pattern supports single character wildcards
(<code>?</code>) and multi-character wildcards (<code>*</code>)</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-regexp-query"><code>regexp</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which match the
regular expression specified.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-fuzzy-query"><code>fuzzy</code> query</a></dt>
<dd>
<p>Find documents where the field specified contains terms which are fuzzily
similar to the specified term.  Fuzziness is measured as a
<a href="http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance">Levenshtein edit distance</a>
of 1 or 2.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-type-query"><code>type</code> query</a></dt>
<dd>
<p>Find documents of the specified type.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-ids-query"><code>ids</code> query</a></dt>
<dd>
<p>Find documents with the specified type and IDs.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-term-query">8.3.1. Term Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-term-query.html[Term Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[term]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-terms-query">8.3.2. Terms Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-terms-query.html[Terms Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[terms]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>values</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-range-query">8.3.3. Range Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-range-query.html[Range Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[range]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>from</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>to</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>include lower value means that <code>from</code> is <code>gt</code> when <code>false</code> or <code>gte</code> when <code>true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>include upper value means that <code>to</code> is <code>lt</code> when <code>false</code> or <code>lte</code> when <code>true</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[range_simplified]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set <code>from</code> to 10 and <code>includeLower</code> to <code>true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set <code>to</code> to 20 and <code>includeUpper</code> to <code>false</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-exists-query">8.3.4. Exists Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-exists-query.html[Exists Query].</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[exists]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-prefix-query">8.3.5. Prefix Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-prefix-query.html[Prefix Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[prefix]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prefix</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-wildcard-query">8.3.6. Wildcard Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-wildcard-query.html[Wildcard Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[wildcard]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>wildcard expression</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-regexp-query">8.3.7. Regexp Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-regexp-query.html[Regexp Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[regexp]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>regexp</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-fuzzy-query">8.3.8. Fuzzy Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-fuzzy-query.html[Fuzzy Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[fuzzy]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>text</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-type-query">8.3.9. Type Query</h4>
<div class="paragraph">
<p>deprecated[7.0.0]</p>
</div>
<div class="paragraph">
<p>Types are being removed, prefer filtering on a field instead. For
more information, see {ref}/removal-of-types.html[Removal of mapping types].</p>
</div>
<div class="paragraph">
<p>See {ref}/query-dsl-type-query.html[Type Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[type]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>type</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-ids-query">8.3.10. Ids Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-ids-query.html[Ids Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[ids]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-compound-queries">8.4. Compound queries</h3>
<div class="paragraph">
<p>Compound queries wrap other compound or leaf queries, either to combine their
results and scores, to change their behaviour, or to switch from query to
filter context.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-constant-score-query"><code>constant_score</code> query</a></dt>
<dd>
<p>A query which wraps another query, but executes it in filter context.  All
matching documents are given the same &#8220;constant&#8221; <code>_score</code>.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-bool-query"><code>bool</code> query</a></dt>
<dd>
<p>The default query for combining multiple leaf or compound query clauses, as
<code>must</code>, <code>should</code>, <code>must_not</code>, or <code>filter</code> clauses.  The <code>must</code> and <code>should</code>
clauses have their scores combined&#8201;&#8212;&#8201;the more matching clauses, the better&#8201;&#8212;&#8201;while the <code>must_not</code> and <code>filter</code> clauses are executed in filter context.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-dis-max-query"><code>dis_max</code> query</a></dt>
<dd>
<p>A query which accepts multiple queries, and returns any documents which match
any of the query clauses.  While the <code>bool</code> query combines the scores from all
matching queries, the <code>dis_max</code> query uses the score of the single best-
matching query clause.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-function-score-query"><code>function_score</code> query</a></dt>
<dd>
<p>Modify the scores returned by the main query with functions to take into
account factors like popularity, recency, distance, or custom algorithms
implemented with scripting.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-boosting-query"><code>boosting</code> query</a></dt>
<dd>
<p>Return documents which match a <code>positive</code> query, but reduce the score of
documents which also match a <code>negative</code> query.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-constant-score-query">8.4.1. Constant Score Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-constant-score-query.html[Constant Score Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[constant_score]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>your query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>query score
==== Bool Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See {ref}/query-dsl-bool-query.html[Bool Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[bool]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>must query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>must not query</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>should query</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a query that must appear in the matching documents but doesn&#8217;t contribute to scoring.
==== Dis Max Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See {ref}/query-dsl-dis-max-query.html[Dis Max Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[dis_max]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>add your queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>add your queries</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>boost factor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>tie breaker
==== Function Score Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See {ref}/query-dsl-function-score-query.html[Function Score Query].</p>
</div>
<div class="paragraph">
<p>To use <code>ScoreFunctionBuilders</code> just import them in your class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">import static org.elasticsearch.index.query.functionscore.ScoreFunctionBuilders.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[function_score]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a first function based on a query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And randomize the score based on a given seed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add another function based on the age field
==== Boosting Query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See {ref}/query-dsl-boosting-query.html[Boosting Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[boosting]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query that will promote documents</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>query that will demote documents</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>negative boost</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-joining-queries">8.5. Joining queries</h3>
<div class="paragraph">
<p>Performing full SQL-style joins in a distributed system like Elasticsearch is
prohibitively expensive.  Instead, Elasticsearch offers two forms of join
which are designed to scale horizontally.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-nested-query"><code>nested</code> query</a></dt>
<dd>
<p>Documents may contains fields of type <code>nested</code>. These
fields are used to index arrays of objects, where each object can be queried
(with the <code>nested</code> query) as an independent document.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-has-child-query"><code>has_child</code></a> and <a href="#java-query-dsl-has-parent-query"><code>has_parent</code></a> queries</dt>
<dd>
<p>A parent-child relationship can exist between two
document types within a single index. The <code>has_child</code> query returns parent
documents whose child documents match the specified query, while the
<code>has_parent</code> query returns child documents whose parent document matches the
specified query.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-nested-query">8.5.1. Nested Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-nested-query.html[Nested Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[nested]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>path to nested document</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>your query. Any fields referenced inside the query must use the complete path (fully qualified).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>score mode could be <code>ScoreMode.Max</code>, <code>ScoreMode.Min</code>, <code>ScoreMode.Total</code>, <code>ScoreMode.Avg</code> or <code>ScoreMode.None</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-has-child-query">8.5.2. Has Child Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-has-child-query.html[Has Child Query]</p>
</div>
<div class="paragraph">
<p>When using the <code>has_child</code> query it is important to use the <code>PreBuiltTransportClient</code> instead of the regular client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Settings settings = Settings.builder().put("cluster.name", "elasticsearch").build();
TransportClient client = new PreBuiltTransportClient(settings);
client.addTransportAddress(new TransportAddress(new InetSocketAddress(InetAddresses.forString("127.0.0.1"), 9300)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise the parent-join module doesn&#8217;t get loaded and the <code>has_child</code> query can&#8217;t be used from the transport client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[has_child]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>child type to query against</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>query</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>score mode can be <code>ScoreMode.Avg</code>, <code>ScoreMode.Max</code>, <code>ScoreMode.Min</code>, <code>ScoreMode.None</code> or <code>ScoreMode.Total</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-has-parent-query">8.5.3. Has Parent Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-has-parent-query.html[Has Parent]</p>
</div>
<div class="paragraph">
<p>When using the <code>has_parent</code> query it is important to use the <code>PreBuiltTransportClient</code> instead of the regular client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Settings settings = Settings.builder().put("cluster.name", "elasticsearch").build();
TransportClient client = new PreBuiltTransportClient(settings);
client.addTransportAddress(new TransportAddress(new InetSocketAddress(InetAddresses.forString("127.0.0.1"), 9300)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise the parent-join module doesn&#8217;t get loaded and the <code>has_parent</code> query can&#8217;t be used from the transport client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[has_parent]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>parent type to query against</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>query</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether the score from the parent hit should propagate to the child hit</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-geo-queries">8.6. Geo queries</h3>
<div class="paragraph">
<p>Elasticsearch supports two types of geo data:
<code>geo_point</code> fields which support lat/lon pairs, and
<code>geo_shape</code> fields, which support points, lines, circles, polygons, multi-polygons etc.</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-geo-shape-query"><code>geo_shape</code></a> query</dt>
<dd>
<p>Find document with geo-shapes which either intersect, are contained by, or
do not intersect with the specified geo-shape.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-bounding-box-query"><code>geo_bounding_box</code></a> query</dt>
<dd>
<p>Finds documents with geo-points that fall into the specified rectangle.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-distance-query"><code>geo_distance</code></a> query</dt>
<dd>
<p>Finds document with geo-points within the specified distance of a central
point.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-geo-polygon-query"><code>geo_polygon</code></a> query</dt>
<dd>
<p>Find documents with geo-points within the specified polygon.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-shape-query">8.6.1. GeoShape Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-geo-shape-query.html[Geo Shape Query]</p>
</div>
<div class="paragraph">
<p>Note: the <code>geo_shape</code> type uses <code>Spatial4J</code> and <code>JTS</code>, both of which are
optional dependencies. Consequently you must add <code>Spatial4J</code> and <code>JTS</code>
to your classpath in order to use this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.locationtech.spatial4j&lt;/groupId&gt;
    &lt;artifactId&gt;spatial4j&lt;/artifactId&gt;
    &lt;version&gt;0.7&lt;/version&gt;                        <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.locationtech.jts&lt;/groupId&gt;
    &lt;artifactId&gt;jts-core&lt;/artifactId&gt;
    &lt;version&gt;1.15.0&lt;/version&gt;                         <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;xerces&lt;/groupId&gt;
            &lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>check for updates in <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.locationtech.spatial4j%22%20AND%20a%3A%22spatial4j%22">Maven Central</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>check for updates in <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.locationtech.jts%22%20AND%20a%3A%22jts-core%22">Maven Central</a></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// Import ShapeRelation and ShapeBuilder
import org.elasticsearch.common.geo.ShapeRelation;
import org.elasticsearch.common.geo.builders.ShapeBuilder;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[geo_shape]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>shape</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>relation can be <code>ShapeRelation.CONTAINS</code>, <code>ShapeRelation.WITHIN</code>, <code>ShapeRelation.INTERSECTS</code> or <code>ShapeRelation.DISJOINT</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[indexed_geo_shape]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The ID of the document that containing the pre-indexed shape.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>relation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Name of the index where the pre-indexed shape is. Defaults to <em>shapes</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The field specified as path containing the pre-indexed shape. Defaults to <em>shape</em>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-bounding-box-query">8.6.2. Geo Bounding Box Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-geo-bounding-box-query.html[Geo Bounding Box Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[geo_bounding_box]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>bounding box top left point</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>bounding box bottom right point</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-distance-query">8.6.3. Geo Distance Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-geo-distance-query.html[Geo Distance Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[geo_distance]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>center point</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>distance from center point</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-geo-polygon-query">8.6.4. Geo Polygon Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-geo-polygon-query.html[Geo Polygon Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[geo_polygon]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>add your polygon of points a document should fall within</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>initialise the query with field and points</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-specialized-queries">8.7. Specialized queries</h3>
<div class="paragraph">
<p>This group contains queries which do not fit into the other groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-mlt-query"><code>more_like_this</code> query</a></dt>
<dd>
<p>This query finds documents which are similar to the specified text, document,
or collection of documents.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-script-query"><code>script</code> query</a></dt>
<dd>
<p>This query allows a script to act as a filter.  Also see the
<a href="#java-query-dsl-function-score-query"><code>function_score</code> query</a>.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-percolate-query"><code>percolate</code> query</a></dt>
<dd>
<p>This query finds percolator queries based on documents.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-wrapper-query"><code>wrapper</code> query</a></dt>
<dd>
<p>A query that accepts other queries as json or yaml string.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-mlt-query">8.7.1. More Like This Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-mlt-query.html[More Like This Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[more_like_this]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>fields</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>text</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>ignore threshold</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>max num of Terms in generated queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-script-query">8.7.2. Script Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-script-query.html[Script Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[script_inline]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inlined script</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have stored on each data node a script named <code>myscript.painless</code> with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="painless">doc['num1'].value &gt; params.param1</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use it then with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[script_file]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Script type: either <code>ScriptType.FILE</code>, <code>ScriptType.INLINE</code> or <code>ScriptType.INDEXED</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Scripting engine</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Script name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Parameters as a <code>Map&lt;String, Object&gt;</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-percolate-query">8.7.3. Percolate Query</h4>
<div class="paragraph">
<p>See:
 * {ref}/query-dsl-percolate-query.html[Percolate Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Settings settings = Settings.builder().put("cluster.name", "elasticsearch").build();
TransportClient client = new PreBuiltTransportClient(settings);
client.addTransportAddress(new TransportAddress(new InetSocketAddress(InetAddresses.forString("127.0.0.1"), 9300)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before the <code>percolate</code> query can be used an <code>percolator</code> mapping should be added and
a document containing a percolator query should be indexed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">// create an index with a percolator field with the name 'query':
client.admin().indices().prepareCreate("myIndexName")
                        .addMapping("_doc", "query", "type=percolator", "content", "type=text")
                        .get();

//This is the query we're registering in the percolator
QueryBuilder qb = termQuery("content", "amazing");

//Index the query = register it in the percolator
client.prepareIndex("myIndexName", "_doc", "myDesignatedQueryName")
    .setSource(jsonBuilder()
        .startObject()
            .field("query", qb) // Register the query
        .endObject())
    .setRefreshPolicy(RefreshPolicy.IMMEDIATE) // Needed when the query shall be available immediately
    .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This indexes the above term query under the name
<strong>myDesignatedQueryName</strong>.</p>
</div>
<div class="paragraph">
<p>In order to check a document against the registered queries, use this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">//Build a document to check against the percolator
XContentBuilder docBuilder = XContentFactory.jsonBuilder().startObject();
docBuilder.field("content", "This is amazing!");
docBuilder.endObject(); //End of the JSON root object

PercolateQueryBuilder percolateQuery = new PercolateQueryBuilder("query", "_doc", BytesReference.bytes(docBuilder));

// Percolate, by executing the percolator query in the query dsl:
SearchResponse response = client().prepareSearch("myIndexName")
        .setQuery(percolateQuery))
        .get();
//Iterate over the results
for(SearchHit hit : response.getHits()) {
    // Percolator queries as hit
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-wrapper-query">8.7.4. Wrapper Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-wrapper-query.html[Wrapper Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[wrapper]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query defined as query builder</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-span-queries">8.8. Span queries</h3>
<div class="paragraph">
<p>Span queries are low-level positional queries which provide expert control
over the order and proximity of the specified terms. These are typically used
to implement very specific queries on legal documents or patents.</p>
</div>
<div class="paragraph">
<p>Span queries cannot be mixed with non-span queries (with the exception of the <code>span_multi</code> query).</p>
</div>
<div class="paragraph">
<p>The queries in this group are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#java-query-dsl-span-term-query"><code>span_term</code> query</a></dt>
<dd>
<p>The equivalent of the <a href="#java-query-dsl-term-query"><code>term</code> query</a> but for use with
other span queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-multi-term-query"><code>span_multi</code> query</a></dt>
<dd>
<p>Wraps a <a href="#java-query-dsl-term-query"><code>term</code></a>, <a href="#java-query-dsl-range-query"><code>range</code></a>,
<a href="#java-query-dsl-prefix-query"><code>prefix</code></a>, <a href="#java-query-dsl-wildcard-query"><code>wildcard</code></a>,
<a href="#java-query-dsl-regexp-query"><code>regexp</code></a>, or <a href="#java-query-dsl-fuzzy-query"><code>fuzzy</code></a> query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-first-query"><code>span_first</code> query</a></dt>
<dd>
<p>Accepts another span query whose matches must appear within the first N
positions of the field.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-near-query"><code>span_near</code> query</a></dt>
<dd>
<p>Accepts multiple span queries whose matches must be within the specified distance of each other, and possibly in the same order.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-or-query"><code>span_or</code> query</a></dt>
<dd>
<p>Combines multiple span queries&#8201;&#8212;&#8201;returns documents which match any of the
specified queries.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-not-query"><code>span_not</code> query</a></dt>
<dd>
<p>Wraps another span query, and excludes any documents which match that query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-containing-query"><code>span_containing</code> query</a></dt>
<dd>
<p>Accepts a list of span queries, but only returns those spans which also match a second span query.</p>
</dd>
<dt class="hdlist1"><a href="#java-query-dsl-span-within-query"><code>span_within</code> query</a></dt>
<dd>
<p>The result from a single span query is returned as long is its span falls
within the spans returned by a list of other span queries.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-term-query">8.8.1. Span Term Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-term-query.html[Span Term Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_term]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>field</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>value</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-multi-term-query">8.8.2. Span Multi Term Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-multi-term-query.html[Span Multi Term Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_multi]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Can be any builder extending the <code>MultiTermQueryBuilder</code> class. For example: <code>FuzzyQueryBuilder</code>,
<code>PrefixQueryBuilder</code>, <code>RangeQueryBuilder</code>, <code>RegexpQueryBuilder</code> or <code>WildcardQueryBuilder</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-first-query">8.8.3. Span First Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-first-query.html[Span First Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_first]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>query</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>max end position</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-near-query">8.8.4. Span Near Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-near-query.html[Span Near Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_near]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>span term queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>slop factor: the maximum number of intervening unmatched positions</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether matches are required to be in-order</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-or-query">8.8.5. Span Or Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-or-query.html[Span Or Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_or]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>span term queries</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-not-query">8.8.6. Span Not Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-not-query.html[Span Not Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_not]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>span query whose matches are filtered</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>span query whose matches must not overlap those returned</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-containing-query">8.8.7. Span Containing Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-containing-query.html[Span Containing Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_containing]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>big</code> part</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>little</code> part</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-query-dsl-span-within-query">8.8.8. Span Within Query</h4>
<div class="paragraph">
<p>See {ref}/query-dsl-span-within-query.html[Span Within Query]</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java[span_within]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>big</code> part</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>little</code> part</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-admin">9. Java API Administration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Elasticsearch provides a full Java API to deal with administration tasks.</p>
</div>
<div class="paragraph">
<p>To access them, you need to call <code>admin()</code> method from a client to get an <code>AdminClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">AdminClient adminClient = client.admin();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin()</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="java-admin-indices">9.1. Indices Administration</h3>
<div class="paragraph">
<p>To access indices Java API, you need to call <code>indices()</code> method from an <a href="#java-admin"><code>AdminClient</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">IndicesAdminClient indicesAdminClient = client.admin().indices();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin().indices()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="java-admin-indices-create-index">9.1.1. Create Index</h4>
<div class="paragraph">
<p>Using an <a href="#java-admin-indices"><code>IndicesAdminClient</code></a>, you can create an index with all default settings and no mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().indices().prepareCreate("twitter").get();</code></pre>
</div>
</div>
<h5 id="java-admin-indices-create-index-settings" class="float">Index Settings</h5>
<div class="paragraph">
<p>Each index created can have specific settings associated with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().indices().prepareCreate("twitter")
        .setSettings(Settings.builder()             <i class="conum" data-value="1"></i><b>(1)</b>
                .put("index.number_of_shards", 3)
                .put("index.number_of_replicas", 2)
        )
        .get();                                     <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Settings for this index</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Execute the action and wait for the result</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-put-mapping">9.1.2. Put Mapping</h4>
<div class="paragraph">
<p>You can add mappings at index creation time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../server/src/test/java/org/elasticsearch/client/documentation/IndicesDocumentationIT.java[index-with-mapping]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#java-admin-indices-create-index">Creates an index</a> called <code>twitter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add a <code>_doc</code> type with a field called <code>message</code> that has the datatype <code>text</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several variants of the above <code>addMapping</code> method, some taking an
<code>XContentBuilder</code> or a <code>Map</code> with the mapping definition as arguments. Make sure
to check the javadocs to pick the simplest one for your use case.</p>
</div>
<div class="paragraph">
<p>The PUT mapping API also allows for updating the mapping after index
creation. In this case you can provide the mapping as a String similar
to the REST API syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">include-tagged::/Users/wangbin/src/git/ElasticSearchChineseGuide/asciidoc/cn/7.1.0/../../server/src/test/java/org/elasticsearch/client/documentation/IndicesDocumentationIT.java[putMapping-request-source]</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Puts a mapping on existing index called <code>twitter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds a new field <code>name</code> to the mapping</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The type can be also provided within the source</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-refresh">9.1.3. Refresh</h4>
<div class="paragraph">
<p>The refresh API allows to explicitly refresh one or more index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().indices().prepareRefresh().get(); <i class="conum" data-value="1"></i><b>(1)</b>
client.admin().indices()
        .prepareRefresh("twitter")               <i class="conum" data-value="2"></i><b>(2)</b>
        .get();
client.admin().indices()
        .prepareRefresh("twitter", "company")   <i class="conum" data-value="3"></i><b>(3)</b>
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Refresh all indices</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Refresh one index</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Refresh many indices</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="java-admin-indices-get-settings">9.1.4. Get Settings</h4>
<div class="paragraph">
<p>The get settings API allows to retrieve settings of index/indices:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">GetSettingsResponse response = client.admin().indices()
        .prepareGetSettings("company", "employee").get();                           <i class="conum" data-value="1"></i><b>(1)</b>
for (ObjectObjectCursor&lt;String, Settings&gt; cursor : response.getIndexToSettings()) { <i class="conum" data-value="2"></i><b>(2)</b>
    String index = cursor.key;                                                      <i class="conum" data-value="3"></i><b>(3)</b>
    Settings settings = cursor.value;                                               <i class="conum" data-value="4"></i><b>(4)</b>
    Integer shards = settings.getAsInt("index.number_of_shards", null);             <i class="conum" data-value="5"></i><b>(5)</b>
    Integer replicas = settings.getAsInt("index.number_of_replicas", null);         <i class="conum" data-value="6"></i><b>(6)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get settings for indices <code>company</code> and <code>employee</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Iterate over results</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Index name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Settings for the given index</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Number of shards for this index</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Number of replicas for this index
==== Update Indices Settings</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can change index settings by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().indices().prepareUpdateSettings("twitter")   <i class="conum" data-value="1"></i><b>(1)</b>
        .setSettings(Settings.builder()                     <i class="conum" data-value="2"></i><b>(2)</b>
                .put("index.number_of_replicas", 0)
        )
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Index to update</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Settings</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-admin-cluster">9.2. Cluster Administration</h3>
<div class="paragraph">
<p>To access cluster Java API, you need to call <code>cluster()</code> method from an <a href="#java-admin"><code>AdminClient</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ClusterAdminClient clusterAdminClient = client.admin().cluster();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the rest of this guide, we will use <code>client.admin().cluster()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="java-admin-cluster-health">9.2.1. Cluster Health</h4>
<div class="sect4">
<h5 id="java-admin-cluster-health-health">Health</h5>
<div class="paragraph">
<p>The cluster health API allows to get a very simple status on the health of the cluster and also can give you
some technical information about the cluster status per index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ClusterHealthResponse healths = client.admin().cluster().prepareHealth().get(); <i class="conum" data-value="1"></i><b>(1)</b>
String clusterName = healths.getClusterName();              <i class="conum" data-value="2"></i><b>(2)</b>
int numberOfDataNodes = healths.getNumberOfDataNodes();     <i class="conum" data-value="3"></i><b>(3)</b>
int numberOfNodes = healths.getNumberOfNodes();             <i class="conum" data-value="4"></i><b>(4)</b>

for (ClusterIndexHealth health : healths.getIndices().values()) { <i class="conum" data-value="5"></i><b>(5)</b>
    String index = health.getIndex();                       <i class="conum" data-value="6"></i><b>(6)</b>
    int numberOfShards = health.getNumberOfShards();        <i class="conum" data-value="7"></i><b>(7)</b>
    int numberOfReplicas = health.getNumberOfReplicas();    <i class="conum" data-value="8"></i><b>(8)</b>
    ClusterHealthStatus status = health.getStatus();        <i class="conum" data-value="9"></i><b>(9)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get information for all indices</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the cluster name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the total number of data nodes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Get the total number of nodes</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Iterate over all indices</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Index name</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Number of shards</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Number of replicas</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Index status</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="java-admin-cluster-health-wait-status">Wait for status</h5>
<div class="paragraph">
<p>You can use the cluster health API to wait for a specific status for the whole cluster or for a given index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">client.admin().cluster().prepareHealth()            <i class="conum" data-value="1"></i><b>(1)</b>
        .setWaitForYellowStatus()                   <i class="conum" data-value="2"></i><b>(2)</b>
        .get();
client.admin().cluster().prepareHealth("company")   <i class="conum" data-value="3"></i><b>(3)</b>
        .setWaitForGreenStatus()                    <i class="conum" data-value="4"></i><b>(4)</b>
        .get();

client.admin().cluster().prepareHealth("employee")  <i class="conum" data-value="5"></i><b>(5)</b>
        .setWaitForGreenStatus()                    <i class="conum" data-value="6"></i><b>(6)</b>
        .setTimeout(TimeValue.timeValueSeconds(2))  <i class="conum" data-value="7"></i><b>(7)</b>
        .get();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prepare a health request</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Wait for the cluster being yellow</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Prepare the health request for index <code>company</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Prepare the health request for index <code>employee</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Wait at most for 2 seconds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the index does not have the expected status and you want to fail in that case, you need
to explicitly interpret the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ClusterHealthResponse response = client.admin().cluster().prepareHealth("company")
        .setWaitForGreenStatus()    <i class="conum" data-value="1"></i><b>(1)</b>
        .get();

ClusterHealthStatus status = response.getIndices().get("company").getStatus();
if (!status.equals(ClusterHealthStatus.GREEN)) {
    throw new RuntimeException("Index is in " + status + " state"); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Wait for the index being green</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Throw an exception if not <code>GREEN</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stored-scripts">9.2.2. Stored Scripts API</h4>
<div class="paragraph">
<p>The stored script API allows one to interact with scripts and templates
stored in Elasticsearch. It can be used to create, update, get,
and delete stored scripts and templates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">PutStoredScriptResponse response = client.admin().cluster().preparePutStoredScript()
                .setId("script1")
                .setContent(new BytesArray("{\"script\": {\"lang\": \"painless\", \"source\": \"_score * doc['my_numeric_field'].value\"} }"), XContentType.JSON)
                .get();

GetStoredScriptResponse response = client().admin().cluster().prepareGetStoredScript()
                .setId("script1")
                .get();

DeleteStoredScriptResponse response = client().admin().cluster().prepareDeleteStoredScript()
                .setId("script1")
                .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store templates simply use "mustache" for the scriptLang.</p>
</div>
<div class="sect4">
<h5 id="_script_language">Script Language</h5>
<div class="paragraph">
<p>The put stored script API allows one to set the language of the stored script.
If one is not provided the default scripting language will be used.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>